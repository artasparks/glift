/*
 Glift: A Responsive Javascript library for the game Go.

 @copyright Josh Hoak
 @license MIT License (see LICENSE.txt)
 @version 0.17.7
 --------------------------------------
*/
(function(a){var b=b||a.glift||{};a&&(a.glift=b)})(window);glift.global={version:"0.17.7",debugMode:!1,performanceDebugLevel:"NONE",perf:{},instanceRegistry:{},activeInstanceId:null,disabledZoom:!1};
glift.init=function(a,b){if(!glift.platform.supportsSvg())throw glift.dom.elem(b).html('Your browser does not support Glift, this Go viewer, due to lack of SVG support. Please upgrade or try one of <a href="http://browsehappy.com/">these</a>'),Error('Your browser does not support Glift, this Go viewer, due to lack of SVG support. Please upgrade or try one of <a href="http://browsehappy.com/">these</a>');if(!glift.global.disabledZoom&&a&&glift.platform.isMobile()){for(var c=document.getElementsByTagName("meta"),
d=0,e=c.length;d<e;d++){var f=c[d]?c[d].getAttribute("name"):null;f&&"viewport"===f.toLowerCase()&&glift.dom.elem(c[d]).remove()}c=glift.dom.elem(document.head);d=glift.dom.elem(document.createElement("meta"));d.attr("name","viewport");d.attr("content","width=device-width, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no");c.prepend(d);glift.global.disabledZoom=!0}};
glift.util={logz:function(a){console.log(a);return null},typeOf:function(a){var b=typeof a;"object"===b&&(a?a instanceof Array&&(b="array"):b="null");return b},isArray:function(a){return a&&"object"===typeof a&&a.constructor===Array},arrayEquals:function(a,b){if(void 0===a||void 0==b||a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},inBounds:function(a,b){return a<b&&0<=a},outBounds:function(a,b){return a>=b||0>a},intersection:function(a,b){var c={},d;for(d in a)void 0!==
b[d]&&(c[d]=1);return c},getKeyWithDefault:function(a,b,c){void 0===a[b]&&(a[b]=c);return a[b]},sizeOf:function(a){var b=0,c;for(c in a)b+=1;return b},setMethods:function(a,b){for(var c in b)a[c]=b[c].bind(a);return a},beget:function(a){var b=function(){};b.prototype=a;return new b},simpleClone:function(a){if("array"!==glift.util.typeOf(a)&&"object"!==glift.util.typeOf(a))return a;if(a instanceof Date){var b=new Date;b.setTime(a.getTime());return b}if("array"===glift.util.typeOf(a)){for(var b=[],
c=0,d=a.length;c<d;c++)b[c]=glift.util.simpleClone(a[c]);return b}if("object"===glift.util.typeOf(a)){b={};for(c in a)a.hasOwnProperty(c)&&(b[c]=glift.util.simpleClone(a[c]));return b}throw Error("Unable to copy obj! Its type isn't supported.");}};glift.util.debugl=function(a){glift.debugOn&&glift.util.log(a)};glift.util.log=function(a){"array"!==glift.util.typeOf(a)&&"object"!==glift.util.typeOf(a)||JSON.stringify(a);void 0!==console&&void 0!==console.log&&console.log(a)};
glift.util.colors={isLegalColor:function(a){return a===glift.enums.states.BLACK||a===glift.enums.states.WHITE||a===glift.enums.states.EMPTY},oppositeColor:function(a){return a===glift.enums.states.BLACK?glift.enums.states.WHITE:a===glift.enums.states.WHITE?glift.enums.states.BLACK:a}};
glift.enums={states:{BLACK:"BLACK",WHITE:"WHITE",EMPTY:"EMPTY"},boardAlignments:{TOP:"TOP",RIGHT:"RIGHT",CENTER:"CENTER"},directions:{LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM"},boardRegions:{LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM",TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT",ALL:"ALL",AUTO:"AUTO"},controllerMessages:{CONTINUE:"CONTINUE",DONE:"DONE",FAILURE:"FAILURE"},marks:{CIRCLE:"CIRCLE",SQUARE:"SQUARE",TRIANGLE:"TRIANGLE",
XMARK:"XMARK",STONE_MARKER:"STONE_MARKER",LABEL:"LABEL",LABEL_ALPHA:"LABEL_ALPHA",LABEL_NUMERIC:"LABEL_NUMERIC",VARIATION_MARKER:"VARIATION_MARKER",CORRECT_VARIATION:"CORRECT_VARIATION"},problemResults:{CORRECT:"CORRECT",INCORRECT:"INCORRECT",INDETERMINATE:"INDETERMINATE",FAILURE:"FAILURE"},displayDataTypes:{PARTIAL:"PARTIAL",FULL:"FULL"},svgElements:{SVG:"svg",BOARD:"board",BOARD_COORD_LABELS:"board_coord_labels",INTERSECTIONS_CONTAINER:"intersections",BOARD_LINE:"board_line",BOARD_LINE_CONTAINER:"board_line_container",
BUTTON:"button",BUTTON_CONTAINER:"button_container",FULL_BOARD_BUTTON:"full_board_button",MARK:"mark",TEMP_MARK_GROUP:"temp_mark_group",MARK_CONTAINER:"mark_container",GLIFT_ELEMENT:"glift_element",STARPOINT:"starpoint",STARPOINT_CONTAINER:"starpoint_container",STONE:"stone",STONE_CONTAINER:"stone_container",STONE_SHADOW:"stone_shadow",STONE_SHADOW_CONTAINER:"stone_shadow_container",GUIDE_LINE:"guide_line",ICON:"icon",ICON_CONTAINER:"icon_container",TEMP_ICON:"temp_icon",TEMP_TEXT:"temp_text",TEMP_ICON_CONTAINER:"temp_icon_container"},
showVariations:{ALWAYS:"ALWAYS",NEVER:"NEVER",MORE_THAN_ONE:"MORE_THAN_ONE"},widgetTypes:{CORRECT_VARIATIONS_PROBLEM:"CORRECT_VARIATIONS_PROBLEM",EXAMPLE:"EXAMPLE",GAME_VIEWER:"GAME_VIEWER",REDUCED_GAME_VIEWER:"REDUCED_GAME_VIEWER",STANDARD_PROBLEM:"STANDARD_PROBLEM",BOARD_EDITOR:"BOARD_EDITOR"},boardComponents:{BOARD:"BOARD",COMMENT_BOX:"COMMENT_BOX",EXTRA_ICONBAR:"EXTRA_ICONBAR",ICONBAR:"ICONBAR",TITLE_BAR:"TITLE_BAR"},dubug:{NONE:"NONE",INFO:"INFO"},rotations:{NO_ROTATION:"NO_ROTATION",CLOCKWISE_90:"CLOCKWISE_90",
CLOCKWISE_180:"CLOCKWISE_180",CLOCKWISE_270:"CLOCKWISE_270"}};(function(){glift.errors={};glift.errors.ParseError=function(a){this.name="ParseError";this.message=a||""};glift.errors.ParseError.prototype=Error()})();glift.util._IdGenerator=function(a){this.seed=a||0};glift.util._IdGenerator.prototype={next:function(){var a=this.seed+"";this.seed+=1;return a}};glift.util.idGenerator=new glift.util._IdGenerator(0);
glift.keyMappings={_nameToCode:{ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,BACKSPACE:8,ENTER:13,SHIFT:16,FORWARD_SLASH:191,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75},nameToCode:function(a){return glift.keyMappings._nameToCode[a]?glift.keyMappings._nameToCode[a]:null},_codeToName:void 0,codeToName:function(a){if(void 0===glift.keyMappings._codeToName){var b={},c;for(c in glift.keyMappings._nameToCode)b[glift.keyMappings._nameToCode[c]]=c;glift.keyMappings._codeToName=b}return glift.keyMappings._codeToName[a]?
glift.keyMappings._codeToName[a]:null},_keyBindingMap:{},registerKeyAction:function(a,b,c){var d=glift.keyMappings._keyBindingMap;glift.keyMappings.nameToCode(b)&&(d[a]||(d[a]={}),a&&b&&c&&(d[a][b]=c))},unregisterInstance:function(a){glift.keyMappings._keyBindingMap[a]&&delete glift.keyMappings._keyBindingMap[a]},getFuncOrIcon:function(a,b){var c=glift.keyMappings._keyBindingMap;return a&&b&&c[a]&&c[a][b]?c[a][b]:null},_initializedListener:!1,initKeybindingListener:function(){glift.keyMappings._initializedListener||
(document.body.addEventListener("keydown",glift.keyMappings._keyHandlerFunc),glift.keyMappings._initializedListener=!0)},_keyHandlerFunc:function(a){var b=glift.keyMappings.codeToName(a.which),c=glift.global.activeInstanceId;if(b=glift.keyMappings.getFuncOrIcon(c,b)){var d=glift.util.typeOf(b);if("function"!==d&&"string"===d&&(c=glift.global.instanceRegistry[c])&&(c=c.getCurrentWidget())){for(var b=b.split("."),d=c.actions[b[0]],e=1;e<b.length;e++)d=d[b[e]];d(a,c)}}}};
glift.math={isEven:function(a){return 0==a%2?!0:!1},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},mostlyEqual:function(a,b,c){return Math.abs(a-b)<c}};
glift.util.perfLog=function(a){if(void 0!==glift.global.performanceDebugLevel&&"NONE"!==glift.global.performanceDebugLevel){var b=glift.util.perfTime(),c=glift.global.perf.last;console.log("Since Major Record: "+(b-glift.global.perf.lastMajor+"ms. "+a));"FINE"===glift.global.performanceDebugLevel&&console.log("  Since Last Record: "+(b-c+"ms. "+a));glift.global.perf.last=b}};
glift.util.majorPerfLog=function(a){if(void 0!==glift.global.performanceDebugLevel&&"NONE"!==glift.global.performanceDebugLevel){var b=glift.util.perfTime();glift.util.perfLog(a);glift.global.perf.lastMajor=b}};glift.util.perfDone=function(){if(void 0!==glift.global.performanceDebugLevel&&"NONE"!==glift.global.performanceDebugLevel){var a=glift.util.perfTime(),b=glift.global.perf.first;console.log("---Performance Test Complete---");console.log("Since Beginning: "+(a-b)+"ms.")}};
glift.util.perfInit=function(){if(void 0!==glift.global.performanceDebugLevel&&"NONE"!==glift.global.performanceDebugLevel){var a=glift.util.perfTime();glift.global.perf={first:a,last:a,lastMajor:a}}};glift.util.perfTime=function(){return(new Date).getTime()};
glift.platform={_isIOS:null,isIOS:function(){if(null!==glift.platform._isIOS)return glift.platform._isIOS;glift.platform._isIOS=/iPhone|iPad|iPod/i.test(navigator.userAgent);return glift.platform._isIOS},_isAndroid:null,isAndroid:function(){if(null!==glift.platform._isAndroid)return glift.platform._isAndroid;glift.platform._isAndroid=/Android/i.test(navigator.userAgent);return glift.platform._isAndroid},_isWinPhone:null,isWinPhone:function(){if(null!==glift.platform._isWinPhone)return glift.platform._isWinPhone;
glift.platform._isWinPhone=/Windows Phone/i.test(navigator.userAgent);return glift.platform._isWinPhone},isMobile:function(){return glift.platform.isAndroid()||glift.platform.isIOS()||glift.platform.isWinPhone()},_supportsSvg:null,supportsSvg:function(){if(null!==glift.platform._supportsSvg)return glift.platform._supportsSvg;glift.platform._supportsSvg=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1");return glift.platform._supportsSvg}};
(function(){glift.util.point=function(b,c){return new a(b,c)};glift.util.coordToString=function(a,c){return a+","+c};glift.util.pointFromString=function(a){try{var c=a.split(","),d=parseInt(c[0]),e=parseInt(c[1]);return glift.util.point(d,e)}catch(f){throw"Parsing Error! Couldn't parse a point from: "+a;}};glift.util.pointFromSgfCoord=function(a){if(2!=a.length)throw"Unknown SGF Coord length: "+a.length;return glift.util.point(a.charCodeAt(0)-97,a.charCodeAt(1)-97)};glift.util.pointFromHash=function(a){return glift.util.pointFromString(a)};
var a=function(a,c){this._x=a;this._y=c};a.prototype={x:function(){return this._x},y:function(){return this._y},equals:function(a){return this._x===a.x()&&this._y===a.y()},clone:function(){return glift.util.point(this.x(),this.y())},toSgfCoord:function(){return String.fromCharCode(this.x()+97)+String.fromCharCode(this.y()+97)},hash:function(){return this.toString()},toString:function(){return glift.util.coordToString(this.x(),this.y())},translate:function(a,c){return glift.util.point(this.x()+a,this.y()+
c)},rotate:function(a,c){var d=glift.enums.rotations;if(0>a||void 0===c||c===d.NO_ROTATION)return this;var e=glift.util.point,f=(a-1)/2,g=e(this.x()-f,f-this.y());if(glift.util.outBounds(this.x(),a)||glift.util.outBounds(this.x(),a))throw Error("rotating a point outside the bounds: "+this.toString());var h=g;c===d.CLOCKWISE_90?h=e(g.y(),-g.x()):c===d.CLOCKWISE_180?h=e(-g.x(),-g.y()):c===d.CLOCKWISE_270&&(h=e(-g.y(),g.x()));return e(f+h.x(),-h.y()+f)},antirotate:function(a,c){var d=glift.enums.rotations;
return c===d.CLOCKWISE_90?this.rotate(a,d.CLOCKWISE_270):c===d.CLOCKWISE_180?this.rotate(a,d.CLOCKWISE_180):c===d.CLOCKWISE_270?this.rotate(a,d.CLOCKWISE_90):this.rotate(a,c)},log:function(){glift.util.logz(this.toString())}}})();
glift.util.regions={getComponents:function(a){var b=glift.enums.boardRegions,c={};a===b.TOP_LEFT?(c[b.TOP]=1,c[b.LEFT]=1):a===b.TOP_RIGHT?(c[b.TOP]=1,c[b.RIGHT]=1):a===b.BOTTOM_LEFT?(c[b.BOTTOM]=1,c[b.LEFT]=1):a===b.BOTTOM_RIGHT?(c[b.BOTTOM]=1,c[b.RIGHT]=1):a==b.TOP?c[b.TOP]=1:a==b.BOTTOM?c[b.BOTTOM]=1:a==b.LEFT?c[b.LEFT]=1:a==b.RIGHT&&(c[b.RIGHT]=1);return c}};
glift.testUtil={ptlistToMap:function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];void 0!==d.value?b[d.point.hash()]=d:b[d.hash()]=d}return b},assertFullDiv:function(a){ok(0<glift.dom.elem(a).html().length,"Div should contain contents.  Was: "+glift.dom.elem(a).html())},assertEmptyDiv:function(a){a=glift.dom.elem(a).html();ok(0===a.toString().length,"Div should not contain contents. Instead was ["+a+"]")}};
glift.dom={elem:function(a){var b=glift.util.typeOf(a);return"string"===b?(b=document.getElementById(a),null===b?null:new glift.dom.Element(b,a)):"object"===b&&a.nodeType&&1===a.nodeType?new glift.dom.Element(a):null},newDiv:function(a){var b=glift.dom.elem(document.createElement("div"));b.attr("id",a);return b},Element:function(a,b){this.el=a;this.id=b||null}};
glift.dom.Element.prototype={prepend:function(a){a.constructor===this.constructor&&this.el.insertBefore(a.el,this.el.firstChild);return this},append:function(a){a.constructor===this.constructor&&this.el.appendChild(a.el);return this},appendText:function(a){a&&(a=this.el.ownerDocument.createTextNode(a),this.el.appendChild(a));return this},attr:function(a,b){if(null==a)return null;var c=glift.util.typeOf(a);if("object"===c)for(var d in a)this.el.setAttribute(d,a[d]);if("string"===c){if(null==b)return this.el.getAttribute(a);
this.el.setAttribute(a,b);"id"===a&&"string"===glift.util.typeOf(b)&&(this.id=b)}return null},css:function(a){for(var b in a)this.el.style[b]=a[b];return this},height:function(){return this.el.clientHeight},width:function(){return this.el.clientWidth},on:function(a,b){b.bind(this);this.el.addEventListener(a,b)},html:function(a){if(void 0!==a)this.el.innerHTML=a;else return this.el.innerHTML},remove:function(){this.el.parentElement&&this.el.parentElement.removeChild(this.el)},empty:function(){for(var a=
this.el;a.firstChild;)a.removeChild(a.firstChild)},offset:function(){var a={top:0,left:0},b=this.el&&this.el.ownerDocument,c=b.documentElement,b=b.defaultView;"undefined"!==glift.util.typeOf(this.el.getBoundingClientRect)&&(a=this.el.getBoundingClientRect());return{top:a.top+b.pageYOffset-c.clientTop,left:a.left+b.pageXOffset-c.clientLeft}},boundingClientRect:function(){return this.el.getBoundingClientRect()}};
glift.ajax={get:function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&(200===c.status||304===c.status?b(c.responseText):console.log("("+c.status+") Error retrieving "+a))};c.onerror=function(){throw Error(c.responseText);};c.open("GET",a,!0);c.send()}};
glift.themes={registered:{},get:function(a){var b=glift.themes.registered;return(a=a in b?b[a]:null)?glift.themes.deepCopy({},a,b.DEFAULT):a},deepCopy:function(a,b,c){for(var d in c){var e=glift.util.typeOf(c[d]),f=c;void 0!==b[d]&&(f=b);switch(e){case "object":a[d]=glift.themes.deepCopy({},b[d]||{},c[d]);break;case "array":for(var e={},f=[],g=c[d].concat(b[d]||[]),h=0;h<g.length;h++){var k=g[h];k in e||(f.push(k),e[k]=1)}a[d]=k;break;default:a[d]=f[d]}}return a},has:function(a){return a in glift.themes.registered},
setGoBoardBackground:function(a,b){if(a)a.board.imagefill=b;else throw"Yikes! Not a theme: cannot set background image.";}};glift.themes.registered.COLORFUL={board:{fill:"#f5be7e"},commentBox:{css:{background:"#CCF",border:"1px solid"}},icons:{DEFAULT:{fill:"#000"},DEFAULT_HOVER:{fill:"#AAA"}}};
glift.themes.registered.DEFAULT={board:{fill:"#f5be7e",stroke:"#000000","stroke-width":1},starPoints:{sizeFraction:0.15,fill:"black"},lines:{stroke:"black","stroke-width":0.5},boardCoordLabels:{fill:"black",stroke:"black",opacity:"0.6","font-family":"sans-serif"},stones:{shadows:{stroke:"none",fill:"none"},marks:{"font-family":"sans-serif"},EMPTY:{fill:"blue",opacity:0,marks:{fill:"black",stroke:"black",VARIATION_MARKER:{stroke:"#A22",fill:"#A22"},CORRECT_VARIATION:{stroke:"#22D",fill:"#22D"}}},BLACK:{fill:"black",
opacity:1,"stroke-width":1,stroke:"black",marks:{fill:"white",stroke:"white",STONE_MARKER:{fill:"#CCF",opacity:0.6}}},BLACK_HOVER:{fill:"black",opacity:0.5},WHITE:{stroke:"black",fill:"white",opacity:1,"stroke-width":1,marks:{fill:"black",stroke:"black",STONE_MARKER:{fill:"#33F",opacity:0.6}}},WHITE_HOVER:{fill:"white",stroke:"black",opacity:0.5}},icons:{vertMargin:5,horzMargin:5,DEFAULT:{fill:"#000",stroke:"black"},DEFAULT_HOVER:{fill:"#AAA",stroke:"black"},tooltips:{padding:"5px",background:"#555",
color:"#EEE",webkitBorderRadius:"10px",MozBorderRadius:"10px",borderRadius:"10px"},tooltipTimeout:2E3},commentBox:{css:{background:"none",padding:"10px",margin:"0px"}},defs:{}};glift.themes.registered.DEPTH={stones:{shadows:{stroke:"none",fill:"#777"},WHITE:{stroke:"white",fill:"white"},WHITE_HOVER:{fill:"white",stroke:"white",opacity:0.5}}};
glift.themes.registered.MOODY={board:{fill:"#777"},stones:{WHITE:{stroke:"white",fill:"white"},WHITE_HOVER:{fill:"white",stroke:"white",opacity:0.5}},icons:{DEFAULT:{fill:"#000",stroke:"black"},DEFAULT_HOVER:{fill:"#AAA",stroke:"black"}},commentBox:{css:{background:"none",border:""}}};glift.themes.registered.TEXTBOOK={board:{fill:"#FFF"},icons:{DEFAULT:{fill:"#000",stroke:"black"},DEFAULT_HOVER:{fill:"#AAA",stroke:"black"}},commentBox:{css:{background:"#FFF"}}};
glift.themes.registered.TRANSPARENT={board:{fill:"none"},icons:{DEFAULT:{fill:"#000",stroke:"black"},DEFAULT_HOVER:{fill:"#AAA",stroke:"black"}},commentBox:{css:{background:"none",border:""}}};
glift.displays={create:function(a,b){glift.util.majorPerfLog("Before environment creation");a.boardBox=b;var c=glift.displays.environment.get(a);glift.util.majorPerfLog("After environment creation");var d=a.theme||"DEFAULT",e=glift.themes.get(d);a.goBoardBackground&&""!==a.goBoardBackground&&glift.themes.setGoBoardBackground(e,a.goBoardBackground);return glift.displays.board.create(c,d,e,a.rotation)}};glift.displays.bboxFromPts=function(a,b){return new glift.displays._BoundingBox(a,b)};
glift.displays.bboxFromDiv=function(a){a=glift.dom.elem(a);return glift.displays.bbox(glift.util.point(0,0),a.width(),a.height())};glift.displays.bbox=function(a,b,c){return new glift.displays._BoundingBox(a,glift.util.point(a.x()+b,a.y()+c))};glift.displays._BoundingBox=function(a,b){this._topLeftPt=a;this._botRightPt=b};
glift.displays._BoundingBox.prototype={topLeft:function(){return this._topLeftPt},botRight:function(){return this._botRightPt},width:function(){return this.botRight().x()-this.topLeft().x()},height:function(){return this.botRight().y()-this.topLeft().y()},top:function(){return this.topLeft().y()},left:function(){return this.topLeft().x()},bottom:function(){return this.botRight().y()},right:function(){return this.botRight().x()},hwRatio:function(){return this.height()/this.width()},center:function(){return glift.util.point(Math.abs((this.botRight().x()-
this.topLeft().x())/2)+this.topLeft().x(),Math.abs((this.botRight().y()-this.topLeft().y())/2)+this.topLeft().y())},contains:function(a){return a.x()>=this.topLeft().x()&&a.x()<=this.botRight().x()&&a.y()>=this.topLeft().y()&&a.y()<=this.botRight().y()},equals:function(a){return a.topLeft()&&this.topLeft().equals(a.topLeft())&&a.botRight()&&this.botRight().equals(a.botRight())},scale:function(a){var b=this.height()*a,c=this.width()*a;a=glift.util.point(this.topLeft().x()*a,this.topLeft().y()*a);return glift.displays.bbox(a,
c,b)},toString:function(){return this.topLeft().toString()+","+this.botRight().toString()},translate:function(a,b){return glift.displays.bboxFromPts(glift.util.point(this.topLeft().x()+a,this.topLeft().y()+b),glift.util.point(this.botRight().x()+a,this.botRight().y()+b))},hSplit:function(a){return this._splitBox("h",a)},vSplit:function(a){return this._splitBox("v",a)},_splitBox:function(a,b){if("array"!==glift.util.typeOf(b))throw"bboxSplits must be specified as an array. Was: "+glift.util.typeOf(b);
if("h"!==a&&"v"!==a)throw"What!? The only splits allowed are 'v' or 'h'.  You supplied: "+a;for(var c=0,d=0;d<b.length;d++)c+=b[d];if(1<=c)throw"The box splits must sum to less than 1, but instead summed to: "+c;b.push(1-c);for(var c=0,e=[],f=this.topLeft().clone(),d=0;d<b.length;d++){var c=d===b.length-1?1:c+b[d],g="h"===a?this.botRight().x():this.topLeft().x()+this.width()*c,h="h"===a?this.topLeft().y()+this.height()*c:this.botRight().y(),g=glift.util.point(g,h);e.push(glift.displays.bboxFromPts(f,
g));g="h"===a?f.x():this.topLeft().x()+this.width()*c;f="h"===a?this.topLeft().y()+this.height()*c:f.y();f=glift.util.point(g,f)}return e}};
(function(){glift.displays.boardPoints=function(b,c,d){for(var e=b.spacing,f=e/2,g=b.bbox,h=b.extensionBox.left()*e,k=b.extensionBox.right()*e,m=g.left()+h,l=b.extensionBox.top()*e,n=b.extensionBox.bottom()*e,g=g.top()+l,q=b.pointTopLeft.x(),p=b.pointTopLeft.y(),r={},s=[],t=0;t<=b.yPoints;t++)for(var v=0;v<=b.xPoints;v++){var u=m+v*e,x=g+t*e,w=glift.util.point(q+v,p+t),u=glift.util.point(u,x);if(d){if(0!==t&&t!==b.yPoints||0!==v&&v!==b.xPoints)0===t||t===b.yPoints?(0===t?u=u.translate(0,-1*l):t===
b.yPoints&&(u=u.translate(0,n)),s.push({label:"ABCDEFGHJKLMNOPQRSTUVWXYZ".charAt(w.x()-1),coordPt:u})):0===v||v===b.xPoints?(0===v?u=u.translate(-1*h,0):v===b.xPoints&&(u=u.translate(k,0)),s.push({label:Math.abs(w.y()-c)+1,coordPt:u})):(w=w.translate(-1,-1),r[w.hash()]={intPt:w,coordPt:u,bbox:glift.displays.bboxFromPts(glift.util.point(u.x()-f,u.y()-f),glift.util.point(u.x()+f,u.y()+f))})}else r[w.hash()]={intPt:w,coordPt:u,bbox:glift.displays.bboxFromPts(glift.util.point(u.x()-f,u.y()-f),glift.util.point(u.x()+
f,u.y()+f))}}return new a(r,e,c,s)};var a=function(a,c,d,e){this.points=a;this.spacing=c;this.radius=c/2;this.numIntersections=d;this.edgeCoordLabels=e;this.dataCache=void 0};a.prototype={getCoord:function(a){return this.points[a.hash()]},forEach:function(a){for(var c in this.points)a(this.points[c])},data:function(){if(void 0!==this.dataCache)return this.dataCache;var a=[];this.forEach(function(c){a.push(c)});return this.dataCache=a},hasCoord:function(a){return void 0!==this.points[a.hash()]},starPoints:function(){for(var a=
glift.util.point,c={9:[[2,6],[4]],13:[[3,9],[6]],19:[[3,9,15]]}[this.numIntersections]||[],d=[],e=0;e<c.length;e++)for(var f=c[e],g=0;g<f.length;g++)for(var h=0;h<f.length;h++){var k=a(f[g],f[h]);this.hasCoord(k)&&d.push(k)}return d}}})();
glift.displays.cropbox={LINE_EXTENSION:0.5,DEFAULT_EXTENSION:0,OVERFLOW:1.5,create:function(a,b,c,d){return new glift.displays._CropBox(a,b,c,d)},getFromRegion:function(a,b,c){var d=glift.util,e=glift.enums.boardRegions;a=a||e.ALL;var f=(c=c||!1)?1:0;b=c?b+1:b-1;var g=Math.ceil(b/2),h=0,k=0,m=b,l=b,n=c=this.DEFAULT_EXTENSION,q=this.DEFAULT_EXTENSION,p=this.DEFAULT_EXTENSION;switch(a){case e.LEFT:l=g+1+f;p=this.LINE_EXTENSION;break;case e.RIGHT:k=g-1-f;n=this.LINE_EXTENSION;break;case e.TOP:m=g+1+
f;q=this.LINE_EXTENSION;break;case e.BOTTOM:h=g-1-f;c=this.LINE_EXTENSION;break;case e.TOP_LEFT:m=g+1+f;q=this.LINE_EXTENSION;l=g+2+f;p=this.LINE_EXTENSION;break;case e.TOP_RIGHT:m=g+1+f;q=this.LINE_EXTENSION;k=g-2-f;n=this.LINE_EXTENSION;break;case e.BOTTOM_LEFT:h=g-1-f;c=this.LINE_EXTENSION;l=g+2+f;p=this.LINE_EXTENSION;break;case e.BOTTOM_RIGHT:h=g-1-f,c=this.LINE_EXTENSION,k=g-2-f,n=this.LINE_EXTENSION}a=glift.displays.bboxFromPts(d.point(k,h),d.point(l,m));d=glift.displays.bboxFromPts(d.point(n,
c),d.point(p,q));return glift.displays.cropbox.create(a,d,0,b)}};glift.displays._CropBox=function(a,b,c,d){this._cbox=a;this._extBox=b};
glift.displays._CropBox.prototype={cbox:function(){return this._cbox},extBox:function(){return this._extBox},xPoints:function(){return this.cbox().width()},yPoints:function(){return this.cbox().height()},widthMod:function(){var a=glift.displays.cropbox.OVERFLOW;return this.cbox().width()+this.extBox().topLeft().x()+this.extBox().botRight().x()+a},heightMod:function(){var a=glift.displays.cropbox.OVERFLOW;return this.cbox().height()+this.extBox().topLeft().y()+this.extBox().botRight().y()+a}};
(function(){glift.displays.environment={get:function(b){var c=glift.util.point;if(b.heightOverride&&b.widthOverride)c=glift.displays.bboxFromPts(c(0,0),c(b.widthOverride,b.heightOverride));else if(b.boardBox)c=b.boardBox;else if(b.divId)c=glift.displays.bboxFromDiv(b.divId);else throw Error("No Bounding Box defined for display environment!");return new a(b,c)},getInitialized:function(a){return glift.displays.environment.get(a).init()}};var a=function(a,c){this.bbox=c;this.divId=a.divId||"glift_display";
this.divHeight=c.height();this.divWidth=c.width();this.boardRegion=a.boardRegion||glift.enums.boardRegions.ALL;this.intersections=a.intersections||19;this.drawBoardCoords=a.drawBoardCoords||!1;this.cropbox=glift.displays.cropbox.getFromRegion(this.boardRegion,this.intersections,this.drawBoardCoords)};a.prototype={init:function(){var a=this.divHeight,c=this.divWidth,d=this.cropbox,a=glift.displays.bboxFromPts(glift.util.point(0,0),glift.util.point(c,a)),c=glift.displays.getResizedBox(a,d),d=glift.displays.getLineBox(c,
d),e=glift.displays.boardPoints(d,this.intersections,this.drawBoardCoords);this.divBox=a;this.goBoardBox=c;this.goBoardLineBox=d;this.boardPoints=e;return this}}})();
glift.displays.ids={generator:function(a){return new glift.displays.ids._Generator(a)},element:function(a,b,c){a=a+"_"+b;return void 0!==c?void 0!==c.x?a+"_"+c.x()+"_"+c.y():a+"_"+c.toString():a},_Generator:function(a){this.divId=a;this._eid=glift.displays.ids.element;this._enum=glift.enums.svgElements;this._svg=this._eid(this.divId,this._enum.SVG);this._board=this._eid(this.divId,this._enum.BOARD);this._boardCoordLabelGroup=this._eid(this.divId,this._enum.BOARD_COORD_LABELS);this._stoneGroup=this._eid(this.divId,
this._enum.STONE_CONTAINER);this._stoneShadowGroup=this._eid(this.divId,this._enum.STONE_SHADOW_CONTAINER);this._starpointGroup=this._eid(this.divId,this._enum.STARPOINT_CONTAINER);this._buttonGroup=this._eid(this.divId,this._enum.BUTTON_CONTAINER);this._boardButton=this._eid(this.divId,this._enum.FULL_BOARD_BUTTON);this._lineGroup=this._eid(this.divId,this._enum.BOARD_LINE_CONTAINER);this._markGroup=this._eid(this.divId,this._enum.MARK_CONTAINER);this._iconGroup=this._eid(this.divId,this._enum.ICON_CONTAINER);
this._intersectionsGroup=this._eid(this.divId,this._enum.BOARD);this._eid(this.divId,this._enum.INTERSECTIONS_CONTAINER);this._tempMarkGroup=this._eid(this.divId,this._enum.TEMP_MARK_CONTAINER)}};
glift.displays.ids._Generator.prototype={svg:function(){return this._svg},board:function(){return this._board},boardCoordLabelGroup:function(){return this._boardCoordLabelGroup},intersections:function(){return this._intersectionsGroup},stoneGroup:function(){return this._stoneGroup},stone:function(a){return this._eid(this.divId,this._enum.STONE,a)},stoneShadowGroup:function(){return this._stoneShadowGroup},stoneShadow:function(a){return this._eid(this.divId,this._enum.STONE_SHADOW,a)},starpointGroup:function(){return this._starpointGroup},
starpoint:function(a){return this._eid(this.divId,this._enum.STARPOINT,a)},buttonGroup:function(){return this._buttonGroup},button:function(a){return this._eid(this.divId,this._enum.BUTTON,a)},fullBoardButton:function(){return this._boardButton},lineGroup:function(){return this._lineGroup},line:function(a){return this._eid(this.divId,this._enum.BOARD_LINE,a)},markGroup:function(){return this._markGroup},mark:function(a){return this._eid(this.divId,this._enum.MARK,a)},tempMarkGroup:function(){return this._tempMarkGroup},
guideLine:function(){return this._eid(this.divId,this._enum.GUIDE_LINE)},iconGroup:function(){return this._iconGroup},icon:function(a){return this._eid(this.divId,this._enum.ICON,a)},tempIconGroup:function(a){return this._eid(this.divId,this._enum.TEMP_ICON_CONTAINER,a)},tempIcon:function(a){return this._eid(this.divId,this._enum.TEMP_ICON,a)},tempIconText:function(a){return this._eid(this.divId,this._enum.TEMP_TEXT,a)}};
glift.displays.getLineBox=function(a,b){var c=glift.displays.cropbox.OVERFLOW/2,d=a.width()/b.widthMod(),e=a.height()/b.heightMod(),f=e*c,g=d*c,e=e*(b.heightMod()-c),c=d*(b.widthMod()-c),h=a.topLeft().x(),k=a.topLeft().y(),f=glift.displays.bboxFromPts(glift.util.point(g+h,f+k),glift.util.point(c+h,e+k));return new glift.displays._LineBox(f,d,b)};
glift.displays._LineBox=function(a,b,c){this.bbox=a;this.spacing=b;this.extensionBox=c.extBox();this.pointTopLeft=c.cbox().topLeft();this.xPoints=c.xPoints();this.yPoints=c.yPoints()};
glift.displays.positionWidget=function(a,b,c,d,e,f){for(var g=glift.enums.boardComponents,h={},k=0;k<d.length;k++)h[d[k]]=!0;c=glift.displays.cropbox.getFromRegion(b,c);d={TOP:!0,BOTTOM:!0};k=!0;h.hasOwnProperty(g.COMMENT_BOX)&&h.hasOwnProperty(g.BOARD)?0.45>a.hwRatio()&&d[b]?k=!1:0.8>a.hwRatio()&&!d[b]&&(k=!1):k=!0;if(k)return b=glift.displays.recalcSplits(h,e),glift.displays.positionWidgetVert(a,c,h,b);b=glift.displays.recalcSplits(h,f);return glift.displays.positionWidgetHorz(a,c,h,b)};
glift.displays._extractRatios=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].ratio);return b};glift.displays.recalcSplits=function(a,b){var c={},d;for(d in b){for(var e=b[d],f=[],g=0,h=0;h<e.length;h++){var k=e[h];a[k.component]&&(f.push({component:k.component,ratio:k.ratio}),g+=k.ratio)}if(0!==f.length){for(h=0;h<f.length;h++)k=f[h],k.ratio/=g;c[d]=f}}return c};
glift.displays.positionWidgetVert=function(a,b,c,d){c=glift.util.point;var e=glift.enums.boardAlignments,f={},g=glift.displays._extractRatios(d.first);1===g.length?(g=[],g.push(a)):g=a.hSplit(g.slice(0,g.length-1));a={};for(var h=0;h<d.first.length;h++)a[d.first[h].component]=g[h];e=glift.displays.getResizedBox(a.BOARD,b,e.TOP);f.boardBox=e;a.COMMENT_BOX&&(g=a.COMMENT_BOX.height(),b=e.width(),d=e.left(),h=e.bottom(),f.commentBox=glift.displays.bbox(c(d,h),b,g));a.ICONBAR&&(a=a.ICONBAR.height(),d=
e.left(),b=e.width(),e=f.commentBox?f.commentBox.bottom():f.boardBox.bottom(),f.iconBarBox=glift.displays.bbox(c(d,e),b,a));return f};
glift.displays.positionWidgetHorz=function(a,b,c,d){var e=glift.util.point,f=glift.enums.boardAlignments,g=glift.enums.boardComponents;if(!g.hasOwnProperty(g.COMMENT_BOX))throw Error("The component map must contain a comment box");var h=glift.displays.getResizedBox(a,b,f.RIGHT);d={};var k=0.5*h.width(),m=0.75*h.width(),l=a.width()-h.width(),k=l<k?0.5:l>=k&&l<m?l/h.width():0.75;d.commentBoxPercentage=k;k*=h.width();h=h.width()/(k+h.width());a=a.vSplit([h]);d.leftSide=a[0];b=glift.displays.getResizedBox(a[0],
b,f.RIGHT);a=a[1];d.rightSide=a;e=glift.displays.bboxFromPts(e(a.topLeft().x(),b.topLeft().y()),e(a.botRight().x(),b.botRight().y()));a.width()>0.75*b.width()&&(e=e.vSplit([0.75*b.width()/e.width()])[0]);c.hasOwnProperty(g.ICONBAR)?(c=e.hSplit([0.9]),d.commentBox=c[0],d.iconBarBox=c[1]):d.commentBox=e;d.boardBox=b;return d};
glift.displays.setNotSelectable=function(a){glift.dom.elem(a).css({webkitTouchCallout:"none",webkitUserSelect:"none",MozUserSelect:"moz-none",msUserSelect:"none","user-select":"none",webkitHighlight:"none",webkitTapHighlightColor:"rgba(0,0,0,0)",cursor:"default"})};
glift.displays.getResizedBox=function(a,b,c){var d=glift.enums.boardAlignments;c=c||d.CENTER;var e=glift.util,f=glift.displays.getCropDimensions(a.width(),a.height(),b),g=f.width,h=f.height,k=a.width()-g,m=a.height()-h,l=c===d.RIGHT?k:k/2,n=c===d.TOP?0:m/2,q=a.topLeft().x()+l,p=a.topLeft().y()+n;a=glift.displays.bbox(e.point(q,p),g,h);glift.global.debugMode&&(a._debugInfo=function(){return{newDims:f,newWidth:g,newHeight:h,xDiff:k,yDiff:m,xDelta:l,yDelta:n,newLeft:q,newTop:p}});return a};
glift.displays.getCropDimensions=function(a,b,c){var d=b/a;c=c.heightMod()/c.widthMod();var e=b,f=a;d>c?e=a*c:d<c&&(f=b/c);return{height:e,width:f}};glift.displays.board={create:function(a,b,c,d){return(new glift.displays.board.Display(a,b,c,d)).draw()}};glift.displays.board.Display=function(a,b,c,d){this._objectHistory=[];this._environment=a;this._themeName=b;this._theme=c;this._rotation=d||glift.enums.rotations.NO_ROTATION;this._intersections=this._svg=this._svgBase=void 0;this._buffer=[]};
glift.displays.board.Display.prototype={boardPoints:function(){return this._environment.boardPoints},boardRegion:function(){return this._environment.boardRegion},divId:function(){return this._environment.divId},intersectionPoints:function(){return this._environment.intersections},intersections:function(){return this._intersections},rotation:function(){return this._rotation},theme:function(){return this._themeName},width:function(){return this._environment.goBoardBox.width()},height:function(){return this._environment.goBoardBox.height()},
init:function(){void 0===this._svg&&(this.destroy(),this._svg=glift.displays.svg.svg({height:"100%",width:"100%",position:"float",top:0,id:this.divId()+"_svgboard"}));this._environment.init();return this},draw:function(){this.init();var a=glift.displays.board,b=this._environment,c=b.boardPoints,d=this._theme,e=this._svg,f=this.divId(),g=glift.displays.svg,h=glift.displays.ids.generator(f);a.boardBase(e,h,b.goBoardBox,d);a.initBlurFilter(f,e);b=g.group().attr("id",h.intersections());e.append(b);a.boardLabels(b,
h,c,d);a.lines(b,h,c,d);a.starpoints(b,h,c,d);a.shadows(b,h,c,d);a.stones(b,h,c,d);a.markContainer(b,h,c,d);a.buttons(b,h,c);this._intersections=new glift.displays.board._Intersections(f,b,c,d,this.rotation());glift.util.majorPerfLog("After display object creation");this.flush();glift.util.majorPerfLog("After flushing to display");return this},flush:function(){this._svg.attachToParent(this.divId());return this},destroy:function(){glift.dom.elem(this.divId()).empty();this._intersections=this._svgBase=
this._svg=void 0;return this}};
glift.displays.board.boardBase=function(a,b,c,d){var e=glift.displays.svg;d.board.imagefill&&a.append(e.image().attr("x",c.topLeft().x()).attr("y",c.topLeft().y()).attr("width",c.width()).attr("height",c.height()).attr("xlink:href",d.board.imagefill).attr("preserveAspectRatio","none"));a.append(e.rect().attr("x",c.topLeft().x()+"px").attr("y",c.topLeft().y()+"px").attr("width",c.width()+"px").attr("height",c.height()+"px").attr("height",c.height()+"px").attr("fill",d.board.imagefill?"none":d.board.fill).attr("stroke",
d.board.stroke).attr("stroke-width",d.board["stroke-width"]).attr("id",b.board()))};glift.displays.board.initBlurFilter=function(a,b){};
glift.displays.board.boardLabels=function(a,b,c,d){var e=glift.displays.svg;b=e.group().attr("id",b.boardCoordLabelGroup());a.append(b);a=c.edgeCoordLabels;for(var f=0,g=a.length;f<g;f++){var h=a[f];b.append(e.text().text(h.label).attr("fill",d.boardCoordLabels.fill).attr("stroke",d.boardCoordLabels.stroke).attr("opacity",d.boardCoordLabels.opacity).attr("text-anchor","middle").attr("dy",".33em").attr("x",h.coordPt.x()).attr("y",h.coordPt.y()).attr("font-family",d.boardCoordLabels["font-family"]).attr("font-size",
0.6*c.spacing))}};
glift.displays.board.buttons=function(a,b,c){var d=glift.displays.svg,e=d.group().attr("id",b.buttonGroup());a.append(e);a=c.data();var f=a[0],g=a[a.length-1];a={tl:f,br:g,spacing:c.spacing};e.append(d.rect().data(a).attr("x",f.coordPt.x()-c.radius).attr("y",f.coordPt.y()-c.radius).attr("width",g.coordPt.x()-f.coordPt.x()+c.spacing).attr("height",g.coordPt.y()-f.coordPt.y()+c.spacing).attr("opacity",0).attr("fill","red").attr("stroke","red").attr("stone_color","EMPTY").attr("id",b.fullBoardButton()))};
glift.displays.board._Intersections=function(a,b,c,d,e){this.divId=a;this.svg=b;this.theme=d;this.rotation=e;this.boardPoints=c;this.idGen=glift.displays.ids.generator(this.divId);this.lastHoverPoint=null;this.events={};this.markPts=[]};
glift.displays.board._Intersections.prototype={setStoneColor:function(a,b){a=a.rotate(this.boardPoints.numIntersections,this.rotation);a.hash();if(void 0===this.theme.stones[b])throw"Unknown color key ["+b+"]";var c=this.svg.child(this.idGen.stoneGroup()).child(this.idGen.stone(a));if(void 0!==c){var d=this.theme.stones[b];c.attr("fill",d.fill).attr("stroke",d.stroke||1).attr("stone_color",b).attr("opacity",d.opacity);c=this.svg.child(this.idGen.stoneShadowGroup());void 0!==c&&(c=c.child(this.idGen.stoneShadow(a)),
1===d.opacity?c.attr("opacity",1):c.attr("opacity",0))}this._flushStone(a);return this},_flushStone:function(a){var b=this.svg.child(this.idGen.stoneGroup()).child(this.idGen.stone(a));b&&(glift.dom.elem(b.attr("id")).attr(b.attrObj()),b=this.svg.child(this.idGen.stoneShadowGroup()),void 0!==b&&(a=b.child(this.idGen.stoneShadow(a)),glift.dom.elem(a.attr("id")).attr(a.attrObj())));return this},addMarkPt:function(a,b,c){a=a.rotate(this.boardPoints.numIntersections,this.rotation);var d=this.svg.child(this.idGen.markGroup());
return this._addMarkInternal(d,a,b,c)},hasMark:function(a){a=a.rotate(this.boardPoints.numIntersections,this.rotation);return this.svg.child(this.idGen.markGroup()).child(this.idGen.mark(a))?!0:!1},addTempMark:function(a,b,c){a=a.rotate(this.boardPoints.numIntersections,this.rotation);var d=this.svg.child(this.idGen.tempMarkGroup());return this._addMarkInternal(d,a,b,c)},clearTempMarks:function(){this.clearMarks(this.svg.child(this.idGen.tempMarkGroup()));return this},_addMarkInternal:function(a,
b,c,d){this._reqClearForMark(b,c)&&this._clearForMark(b);var e=this.svg.child(this.idGen.stoneGroup()).child(this.idGen.stone(b));if(e){var e=e.attr("stone_color"),f=this.theme.stones;glift.displays.board.addMark(a,this.idGen,this.boardPoints,f[e].marks,f,b,c,d);this._flushMark(b,c,a)}return this},_reqClearForMark:function(a,b){var c=glift.enums.marks,d=this.svg.child(this.idGen.stoneGroup()).child(this.idGen.stone(a));return d?"EMPTY"===d.attr("stone_color")&&(b===c.LABEL||b===c.VARIATION_MARKER||
b===c.CORRECT_VARIATION||b===c.LABEL_NUMERIC||b===c.LABEL_ALPHA):!1},_clearForMark:function(a){var b=this.svg.child(this.idGen.starpointGroup()).child(this.idGen.starpoint(a));b&&b.attr("opacity",0);this.svg.child(this.idGen.lineGroup()).child(this.idGen.line(a)).attr("opacity",0);return this},_flushMark:function(a,b,c){var d=this.svg,e=this.idGen;this._reqClearForMark(a,b)&&((b=d.child(e.starpointGroup()).child(e.starpoint(a)))&&glift.dom.elem(b.attr("id")).attr("opacity",b.attr("opacity")),d=d.child(e.lineGroup()).child(e.line(a)),
glift.dom.elem(d.attr("id")).attr("opacity",d.attr("opacity")));c.child(e.mark(a)).attachToParent(c.attr("id"));this.markPts.push(a);return this},clearMarks:function(a){a=a||this.svg.child(this.idGen.markGroup());for(var b=this.idGen,c=a.children(),d=0,e=c.length;d<e;d++){var f=c[d].data(),g=this.svg.child(b.starpointGroup()).child(b.starpoint(f));g&&g.attr("opacity",1).updateAttrInDom("opacity");(f=this.svg.child(b.lineGroup()).child(b.line(f)))&&f.attr("opacity",1).updateAttrInDom("opacity")}a.emptyChildren();
glift.dom.elem(a.attr("id")).empty();return this},addGuideLines:function(a){var b=glift.displays.svg,c=this.svg.child(this.idGen.markGroup());c.rmChild(this.idGen.guideLine());a=this.boardPoints.getCoord(a);var d=this.boardPoints;c.append(b.path().attr("d",glift.displays.board.intersectionLine(a,8*d.radius,d.numIntersections)).attr("stroke-width",3).attr("stroke","blue").attr("id",this.idGen.guideLine()))},clearGuideLines:function(){this.svg.child(this.idGen.markGroup()).rmChild(this.idGen.guideLine());
return this},setGroupAttr:function(a,b){var c=this.svg.child(a);if(void 0!==c)for(var c=c.children(),d=0,e=c.length;d<e;d++)for(var f in b)c[d].attr(f,b[f]);return this},clearStones:function(){var a={opacity:0,stone_color:"EMPTY"},b={opacity:0};this.setGroupAttr(this.idGen.stoneGroup(),a).setGroupAttr(this.idGen.stoneShadowGroup(),b);for(var c=this.svg.child(this.idGen.stoneGroup()).children(),d=0,e=c.length;d<e;d++)glift.dom.elem(c[d].attr("id")).attr(a);if(d=this.svg.child(this.idGen.stoneShadowGroup()))for(a=
d.children(),d=0,e=a.length;d<e;d++)glift.dom.elem(a[d].attr("id")).attr(b);return this},clearAll:function(){this.clearMarks().clearStones();return this},setEvent:function(a,b){var c=this,d=this.svg.child(this.idGen.buttonGroup()).child(this.idGen.fullBoardButton()).attr("id");glift.dom.elem(d).on(a,function(a){var d=c._buttonEventPt(a);d&&b(a,d)});return this},setHover:function(a,b){var c=this,d=this.svg.child(this.idGen.buttonGroup()).child(this.idGen.fullBoardButton()).attr("id");glift.dom.elem(d).on("mousemove",
function(d){var f=c.lastHoverPoint,g=c._buttonEventPt(d);g&&f&&!f.equals(g)?(b(d,f),a(d,g)):!f&&g&&a(d,g);c.lastHoverPoint=g});glift.dom.elem(d).on("mouseout",function(a){var d=c.lastHoverPoint;c.lastHoverPoint=null;d&&b(a,d)})},_buttonEventPt:function(a){var b=this.svg.child(this.idGen.buttonGroup()).child(this.idGen.fullBoardButton()).data(),c=this.boardPoints.numIntersections,d=glift.dom.elem(this.idGen.fullBoardButton()).offset(),e=b.tl.intPt.x(),f=a.pageX;a.changedTouches&&a.changedTouches[0]&&
(f=a.changedTouches[0].pageX);f=Math.floor((f-d.left)/b.spacing)+e;f<e?f=e:f>c-1&&(f=c-1);var e=b.tl.intPt.y(),g=a.pageY;a.changedTouches&&a.changedTouches[0]&&(g=a.changedTouches[0].pageY);a=Math.floor((g-d.top)/b.spacing)+e;a<e?a=e:a>c-1&&(a=c-1);c=glift.util.point(f,a);this.rotation!=glift.enums.rotations.NO_ROTATION&&(c=c.antirotate(this.boardPoints.numIntersections,this.rotation));return c}};
glift.displays.board.lines=function(a,b,c,d){var e=glift.displays.svg,f=e.group().attr("id",b.lineGroup());a.append(f);a=c.data();for(var g=0,h=a.length;g<h;g++){var k=a[g];f.append(e.path().attr("d",glift.displays.board.intersectionLine(k,c.radius,c.numIntersections)).attr("stroke",d.lines.stroke).attr("stroke-width",d.lines["stroke-width"]).attr("stroke-linecap","round").attr("id",b.line(k.intPt)))}};
glift.displays.board.intersectionLine=function(a,b,c){var d=c-1;c=a.coordPt;var e=a.intPt;a=glift.displays.svg.pathutils;var f=0===e.y()?c.y():c.y()-b,g=e.y()===d?c.y():c.y()+b,h=0===e.x()?c.x():c.x()-b;b=e.x()===d?c.x():c.x()+b;return a.move(c.x(),f)+" "+a.lineAbs(c.x(),g)+" "+a.move(h,c.y())+" "+a.lineAbs(b,c.y())};glift.displays.board.markContainer=function(a,b){a.append(glift.displays.svg.group().attr("id",b.markGroup()));a.append(glift.displays.svg.group().attr("id",b.tempMarkGroup()))};
glift.displays.board.addMark=function(a,b,c,d,e,f,g,h){var k=glift.displays.svg.pathutils,m=glift.displays.svg,l=glift.enums.marks,n=c.getCoord(f).coordPt;b=b.mark(f);var q=c.radius/8;g===l.LABEL||g===l.VARIATION_MARKER||g===l.CORRECT_VARIATION||g===l.LABEL_ALPHA||g===l.LABEL_NUMERIC?(g===l.VARIATION_MARKER?d=d.VARIATION_MARKER:g===l.CORRECT_VARIATION&&(d=d.CORRECT_VARIATION),a.append(m.text().text(h).data(f).attr("fill",d.fill).attr("stroke",d.stroke).attr("text-anchor","middle").attr("dy",".33em").attr("x",
n.x()).attr("y",n.y()).attr("font-family",e.marks["font-family"]).attr("font-size",0.7*c.spacing).attr("id",b))):g===l.SQUARE?(c=c.radius/1.41421356237,k=c-q,a.append(m.rect().data(f).attr("x",n.x()-k).attr("y",n.y()-k).attr("width",2*k).attr("height",2*k).attr("fill","none").attr("stroke-width",2).attr("stroke",d.stroke).attr("id",b))):g===l.XMARK?(c=c.radius/1.41421356237,h=c-q,c=n.translate(-1*h,-1*h),e=n.translate(h,-1*h),g=n.translate(-1*h,h),h=n.translate(h,h),a.append(m.path().data(f).attr("d",
k.movePt(n)+" "+k.lineAbsPt(c)+" "+k.movePt(n)+" "+k.lineAbsPt(e)+" "+k.movePt(n)+" "+k.lineAbsPt(g)+" "+k.movePt(n)+" "+k.lineAbsPt(h)).attr("stroke-width",2).attr("stroke",d.stroke).attr("id",b))):g===l.CIRCLE?a.append(m.circle().data(f).attr("cx",n.x()).attr("cy",n.y()).attr("r",c.radius/2).attr("fill","none").attr("stroke-width",2).attr("stroke",d.stroke).attr("id",b)):g===l.STONE_MARKER?a.append(m.circle().data(f).attr("cx",n.x()).attr("cy",n.y()).attr("r",c.radius/3).attr("opacity",d.STONE_MARKER.opacity).attr("fill",
d.STONE_MARKER.fill).attr("id",b)):g===l.TRIANGLE&&(g=c.radius-c.radius/5,c=n.translate(0.866025403785*g,0.5*g),e=n.translate(-0.866025403785*g,0.5*g),n=n.translate(0,-1*g),a.append(m.path().data(f).attr("fill","none").attr("d",k.movePt(n)+" "+k.lineAbsPt(e)+" "+k.lineAbsPt(c)+" "+k.lineAbsPt(n)).attr("stroke-width",2).attr("stroke",d.stroke).attr("id",b)));return this};
glift.displays.board.starpoints=function(a,b,c,d){var e=glift.displays.svg,f=e.group().attr("id",b.starpointGroup());a.append(f);a=d.starPoints.sizeFraction*c.spacing;for(var g=c.starPoints(),h=0,k=g.length;h<k;h++){var m=g[h],l=c.getCoord(m).coordPt;f.append(e.circle().attr("cx",l.x()).attr("cy",l.y()).attr("r",a).attr("fill",d.starPoints.fill).attr("opacity",1).attr("id",b.starpoint(m)))}};
glift.displays.board.stones=function(a,b,c,d){d=glift.displays.svg;var e=d.group().attr("id",b.stoneGroup());a.append(e);a=c.data();for(var f=0,g=a.length;f<g;f++){var h=a[f];e.append(d.circle().attr("cx",h.coordPt.x()).attr("cy",h.coordPt.y()).attr("r",c.radius-0.4).attr("opacity",0).attr("stone_color","EMPTY").attr("fill","blue").attr("class",glift.enums.svgElements.STONE).attr("id",b.stone(h.intPt)))}};
glift.displays.board.shadows=function(a,b,c,d){if(void 0===d.stones.shadows)return{};var e=glift.displays.svg,f=e.group().attr("id",b.stoneShadowGroup());a.append(f);a=c.data();for(var g=0,h=a.length;g<h;g++){var k=a[g];f.append(e.circle().attr("cx",k.coordPt.x()+c.radius/7).attr("cy",k.coordPt.y()+c.radius/7).attr("r",c.radius-0.4).attr("opacity",0).attr("fill",d.stones.shadows.fill).attr("class",glift.enums.svgElements.STONE_SHADOW).attr("id",b.stoneShadow(k.intPt)))}};
glift.displays.commentbox={};glift.displays.commentbox.create=function(a,b,c){if(!c)throw Error("Theme must be defined. was: "+c);return(new glift.displays.commentbox._CommentBox(a,b,c)).draw()};glift.displays.commentbox._CommentBox=function(a,b,c){this.divId=a;this.bbox=glift.displays.bboxFromPts(glift.util.point(0,0),glift.util.point(b.width(),b.height()));this.theme=c;this.el=void 0};
glift.displays.commentbox._CommentBox.prototype={draw:function(){this.el=glift.dom.elem(this.divId);if(null===this.el)throw Error("Could not find element with ID "+this.divId);var a={"overflow-y":"auto",overflowY:"auto",MozBoxSizing:"border-box",boxSizing:"border-box"},b;for(b in this.theme.commentBox.css)a[b]=this.theme.commentBox.css[b];this.el.css(a);return this},sanitize:function(a){return glift.displays.commentbox.sanitize(a)},setText:function(a){a=this.sanitize(a);this.el.empty();a=a.split("\n");
for(var b=0;b<a.length;b++){var c=a[b],d=glift.dom.elem(document.createElement("p"));d.css({margin:0,padding:0,"min-height":"1em"});d.html(c);this.el.append(d)}},clearText:function(){this.el.empty()},destroy:function(){this.commentBoxObj.empty()}};glift.displays.commentbox.sanitizeWhitelist_={br:!0,b:!0,strong:!0,i:!0,u:!0,em:!0};
glift.displays.commentbox.sanitize=function(a){for(var b=[],c=[],d=glift.displays.commentbox.sanitizeWhitelist_,e=1,f=0,g=0,h=a.length;g<h;g++){var k=a.charAt(g);"<"===k?(e=2,f++,1<f&&c.push("&lt;")):">"===k?(f--,0>f?(e=1,f=0,b.push("&gt;")):0<f?c.push("&gt;"):0===f&&(e=1,k=c.join(""),c=[],k in d?b.push("<"+k+">"):"/"===k.charAt(0)&&k.substring(1,k.length)in d?b.push("<"+k+">"):b.push("&lt;"+k+"&gt;"))):2===e?c.push(k):b.push(k)}return b.join("")};glift.displays.gui={};
glift.displays.gui.rowCenterSimple=function(a,b,c,d,e){return glift.displays.gui._linearCentering(a,b,c,d,e,0,"h")};glift.displays.gui.columnCenterSimple=function(a,b,c,d,e){return glift.displays.gui._linearCentering(a,b,c,d,e,0,"v")};
glift.displays.gui._linearCentering=function(a,b,c,d,e,f,g){var h=a.width()-2*d,k=a.height();e=e||0;f=f||0;var m=k-2*c,k=[],l=[];g="v"===g||"h"===g?g:"h";var n=function(a,b){return"h"===b?a.width():a.height()},q=n(a,g);f=0>=f?1E7:f;e=0>=e?0:e;for(var p=0,r=0;r<b.length;r++){var s=m>h?h/b[r].width():m/b[r].height(),t={scale:s},s=b[r].scale(s);k.push(t);l.push(s);p+=n(s,g);r<b.length-1&&(p+=e)}for(b=[];q<p;)r=l.pop(),k.pop(),p-=n(r,g),p-=e,b.push(r);t="h"===g?h-p:m-p;r=e=s=t/(k.length+1);s>f&&(e=f,
r=(t-e*(k.length-1))/2);d=a.left()+d;a=a.top()+c;"h"===g?d+=r:a+=r;c=[];for(r=0;r<l.length;r++)s=l[r],t=k[r],f=a-s.top(),h=d-s.left(),t.xMove=h,t.yMove=f,c.push(s.translate(h,f)),"h"===g?d+=s.width()+e:a+=s.height()+e;return{transforms:k,bboxes:c,unfit:b}};
glift.displays.gui.centerWithin=function(a,b,c,d){var e=a.width()-2*d,f=a.height()-2*c,g=1,g=f/e>b.height()/b.width()?e/b.width():f/b.width();b=b.scale(g);d=a.left()+d;b.width()<e&&(d+=(e-b.width())/2);a=a.top()+c;b.height()<f&&(a+=(f-b.height())/2);f={xMove:d-b.left(),yMove:a-b.top(),scale:g};b=b.translate(f.xMove,f.yMove);return{transform:f,bbox:b}};glift.displays.icons={};
glift.displays.icons.bar=function(a){var b=a.divId,c=a.icons||[],d=a.theme,e=a.parentBbox;a=a.positioning;if(!d)throw Error("Theme undefined in iconbar");if(!b)throw Error("Must define an options 'divId' as an option");return(new glift.displays.icons._IconBar(b,a,c,e,d)).draw()};
glift.displays.icons._IconBar=function(a,b,c,d,e){this.divId=a;this.position=b;this.divBbox=glift.displays.bboxFromPts(glift.util.point(0,0),glift.util.point(b.width(),b.height()));this.theme=e;this.parentBbox=d;this.icons=glift.displays.icons.wrapIcons(c);this.nameMapping={};this.vertMargin=this.theme.icons.vertMargin;this.horzMargin=this.theme.icons.horzMargin;this.svg=void 0;this.idGen=glift.displays.ids.generator(this.divId);this.tooltipTimer=void 0;this._initIconIds();this._initNameMapping()};
glift.displays.icons._IconBar.prototype={_initNameMapping:function(){var a=this;this.forEachIcon(function(b){a.nameMapping[b.iconName]=b})},_initIconIds:function(){var a=this;this.forEachIcon(function(b){b.setElementId(a.idGen.icon(b.iconName))})},draw:function(){this.destroy();var a=glift.displays.svg,b=this.divBbox;this.bbox=b;this.svg=a.svg().attr("width","100%").attr("height","100%");glift.displays.icons.rowCenterWrapped(b,this.icons,this.vertMargin,this.horzMargin);this._createIcons();this._createIconButtons();
this.flush();return this},_createIcons:function(){var a=glift.displays.svg,b=a.group().attr("id",this.idGen.iconGroup());this.svg.append(b);this.svg.append(a.group().attr("id",this.idGen.tempIconGroup()));for(var c=0,d=this.icons.length;c<d;c++){var e=this.icons[c];b.append(a.path().attr("d",e.iconStr).attr("fill",this.theme.icons.DEFAULT.fill).attr("id",e.elementId).attr("transform",e.transformString()))}},_createIconButtons:function(){var a=glift.displays.svg,b=a.group().attr("id",this.idGen.buttonGroup());
this.svg.append(b);for(var c=0,d=this.icons.length;c<d;c++){var e=this.icons[c];b.append(a.rect().data(e.iconName).attr("x",e.bbox.topLeft().x()).attr("y",e.bbox.topLeft().y()).attr("width",e.bbox.width()).attr("height",e.bbox.height()).attr("fill","blue").attr("opacity",0).attr("id",this.idGen.button(e.iconName)))}},flush:function(){this.svg.attachToParent(this.divId);var a=this.getIcon("multiopen");void 0!==a&&this.setCenteredTempIcon("multiopen",a.getActive(),"black")},setCenteredTempIcon:function(a,
b,c,d,e){var f=glift.displays.svg;e=e||2;d=d||2;a=this.getIcon(a);b="string"===glift.util.typeOf(b)?glift.displays.icons.wrappedIcon(b):b.rewrapIcon();var g=this.idGen.tempIcon(a.iconName);glift.dom.elem(g)&&glift.dom.elem(g).remove();b=void 0!==a.subboxIcon?a.centerWithinSubbox(b,d,e):a.centerWithinIcon(b,d,e);this.svg.child(this.idGen.tempIconGroup()).appendAndAttach(f.path().attr("d",b.iconStr).attr("fill",c).attr("id",g).attr("transform",b.transformString()));return this},addTempText:function(a,
b,c){var d=glift.displays.svg,e=this.getIcon(a).bbox,f=0.54*e.width();this.idGen.tempIconText(a);this.clearTempText(a);this.svg.child(this.idGen.tempIconGroup()).appendAndAttach(d.text().text(b).attr("fill",c).attr("stroke",c).attr("class","tempIcon").attr("font-family","sans-serif").attr("font-size",f+"px").attr("x",e.center().x()).attr("y",e.center().y()).attr("dy",".33em").attr("style","text-anchor: middle; vertical-align: middle;").attr("id",this.idGen.tempIconText(a)).attr("lengthAdjust","spacing"));
return this},clearTempText:function(a){this.svg.rmChild(this.idGen.tempIconText(a));(a=glift.dom.elem(this.idGen.tempIconText(a)))&&a.remove()},createIconSelector:function(a,b){},destroyIconSelector:function(){},destroyTempIcons:function(){this.svg.child(this.idGen.tempIconGroup()).emptyChildrenAndUpdate();return this},buttonId:function(a){return glift.displays.gui.elementId(this.divId,glift.enums.svgElements.BUTTON,a)},initIconActions:function(a,b){this.forEachIcon(function(c){var d=c.iconName;if(b.hasOwnProperty(c.iconName)){var e=
{};glift.platform.isMobile()?e.touchstart=b[d].click:e.click=b[d].click;glift.platform.isMobile()||(e.mouseover=b[d].mouseover||function(a,b,c){glift.dom.elem(c.elementId).attr("fill",b.iconBar.theme.icons.DEFAULT_HOVER.fill)},e.mouseout=b[d].mouseout||function(a,b,c){(a=glift.dom.elem(c.elementId))&&a.attr("fill",b.iconBar.theme.icons.DEFAULT.fill)});for(var f in e)this._initOneIconAction(a,c,f,e[f]);b[d].tooltip&&!glift.platform.isMobile()&&this._initializeTooltip(c,b[d].tooltip)}}.bind(this))},
_initOneIconAction:function(a,b,c,d){var e=this.idGen.button(b.iconName);glift.dom.elem(e).on(c,function(c){a.manager.setActive();d(c,a,b,this)}.bind(this))},_initializeTooltip:function(a,b){var c=this.divId+"_tooltip",d=this,e=this.idGen.button(a.iconName);glift.dom.elem(e).on("mouseover",function(e){e=function(){var e=glift.dom.newDiv(c);e.appendText(b);var f={position:"absolute",top:-1.2*a.bbox.height()+"px","z-index":2,boxSizing:"border-box"},k;for(k in d.theme.icons.tooltips)f[k]=d.theme.icons.tooltips[k];
e.css(f);(f=glift.dom.elem(d.divId))&&f.append(e);this.tooltipTimer=null}.bind(this);this.tooltipTimer=setTimeout(e,d.theme.icons.tooltipTimeout)});glift.dom.elem(e).on("mouseout",function(a){null!=this.tooltipTimer&&clearTimeout(this.tooltipTimer);this.tooltipTimer=null;glift.dom.elem(c)&&glift.dom.elem(c).remove()})},setHover:function(a,b,c){this.setEvent(a,"mouseover",b);this.setEvent(a,"mouseout",c)},hasIcon:function(a){return void 0===this.newIconBboxes[a]},getIcon:function(a){var b=glift.util.typeOf(a);
if("string"===b)return this.nameMapping[a];if("number"===b)return this.icons[a]},forEachIcon:function(a){for(var b=0,c=this.icons.length;b<c;b++)a(this.icons[b])},redraw:function(){this.destroy();this.draw()},destroy:function(){this.divId&&glift.dom.elem(this.divId)&&glift.dom.elem(this.divId).empty();this.tooltipTimer&&(clearTimeout(this.tooltipTimer),this.tooltipTimer=null);this.bbox=void 0;return this}};
glift.displays.icons.rowCenterWrapped=function(a,b,c,d,e){return glift.displays.icons._centerWrapped(a,b,c,d,e,"h")};glift.displays.icons.columnCenterWrapped=function(a,b,c,d,e){return glift.displays.icons._centerWrapped(a,b,c,d,e,"v")};
glift.displays.icons._centerWrapped=function(a,b,c,d,e,f){var g=[];"h"!==f&&"v"!==f&&(f="h");for(var h=0;h<b.length;h++)g.push(b[h].bbox);e=e||0;a=("h"===f?glift.displays.gui.rowCenterSimple(a,g,c,d,e):glift.displays.gui.columnCenterSimple(a,g,c,d,e)).transforms;for(h=0;h<a.length&&h<b.length;h++)b[h].performTransform(a[h]);return a};glift.displays.icons.iconSelector=function(a,b,c){return(new glift.displays.icons._IconSelector(a,b,c)).draw()};
glift.displays.icons._IconSelector=function(a,b,c){this.iconBarId=b;this.parentDivId=a;this.icon=c;this.baseId="iconSelector_"+a;this.wrapperDivId=this.baseId+"_wrapper";this.displayedIcons=void 0;this.columnIdList=[];this.svgColumnList=[];this.iconList=[]};
glift.displays.icons._IconSelector.prototype={draw:function(){this.destroy();var a=glift.displays.svg,b=glift.displays.bboxFromDiv(this.parentDivId),c=glift.dom.elem(this.iconBarId).boundingClientRect().left,d=glift.displays.bboxFromDiv(this.iconBarId),e=this.icon.bbox;e.height();for(var f=b.height()-d.height(),g=[],h=0;h<this.icon.associatedIcons.length;h++)g.push(this.icon.associatedIcons[h].rewrapIcon());var k=glift.dom.newDiv(this.wrapperDivId);k.css({position:"absolute",height:b.height()+"px",
width:b.width()+"px"});glift.dom.elem(this.parentDivId).append(k);for(b=0;0<g.length;){this.iconList.push([]);h=this.baseId+"_column_"+b;this.columnIdList.push(h);var m=glift.dom.newDiv(h);m.css({bottom:d.height()+"px",height:f+"px",left:c+b*e.width()+"px",width:e.width()+"px",position:"absolute"});k.append(m);var m=glift.displays.bboxFromDiv(h),l=glift.displays.icons.columnCenterWrapped(m,g,5,5),m=h+"_svg",n=a.svg().attr("id",h+"_svg").attr("height","100%").attr("width","100%"),h=glift.displays.ids.generator(h),
q=a.group().attr("id",h.iconGroup());n.append(q);h=0;for(l=l.length;h<l;h++){var p=g.shift();p.setElementId(m+"_"+p.iconName);this.iconList[b].push(p);q.append(a.path().attr("d",p.iconStr).attr("fill","black").attr("id",p.elementId).attr("transform",p.transformString()))}this.svgColumnList.push(n);b++}this._createIconButtons();this._setBackgroundEvent();for(h=0;h<this.svgColumnList.length;h++)this.svgColumnList[h].attachToParent(this.columnIdList[h]);return this},_createIconButtons:function(){for(var a=
glift.displays.svg,b=0;b<this.iconList.length;b++){var c=this.svgColumnList[b],d=glift.displays.ids.generator(this.columnIdList[b]),e=this.iconList[b],f=a.group().attr("id",d.buttonGroup());c.append(f);for(c=0;c<e.length;c++){var g=e[c];f.append(a.rect().data(g.iconName).attr("x",g.bbox.topLeft().x()).attr("y",g.bbox.topLeft().y()).attr("width",g.bbox.width()).attr("height",g.bbox.height()).attr("fill","blue").attr("opacity",0).attr("id",d.button(g.iconName)))}}},_setBackgroundEvent:function(){glift.dom.elem(this.wrapperDivId).on("click",
function(a){this.remove()});return this},setIconEvents:function(a,b){for(var c=0;c<this.iconList.length;c++)for(var d=glift.displays.ids.generator(this.columnIdList[c]),e=0;e<this.iconList[c].length;e++){var f=this.iconList[c][e],g=d.button(f.iconName);this._setOneEvent(a,g,f,b)}return this},_setOneEvent:function(a,b,c,d){glift.dom.elem(b).on(a,function(a){d(a,c)});return this},destroy:function(){glift.dom.elem(this.wrapperDivId)&&glift.dom.elem(this.wrapperDivId).remove();return this}};
glift.displays.icons.svg={cross:{string:"M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z",bbox:{x:8.116,y:7.585,x2:24.778,y2:24.248,width:16.662,height:16.663}},check:{string:"M2.379,14.729 5.208,11.899 12.958,19.648 25.877,6.733 28.707,9.561 12.958,25.308z",bbox:{x:2.379,y:6.733,x2:28.707,y2:25.308,width:26.328,height:18.575}},refresh:{string:"M24.083,15.5c-0.009,4.739-3.844,8.574-8.583,8.583c-4.741-0.009-8.577-3.844-8.585-8.583c0.008-4.741,3.844-8.577,8.585-8.585c1.913,0,3.665,0.629,5.09,1.686l-1.782,1.783l8.429,2.256l-2.26-8.427l-1.89,1.89c-2.072-1.677-4.717-2.688-7.587-2.688C8.826,3.418,3.418,8.826,3.416,15.5C3.418,22.175,8.826,27.583,15.5,27.583S27.583,22.175,27.583,15.5H24.083z",
bbox:{x:3.416,y:3.415,x2:27.583,y2:27.583,width:24.167,height:24.168}},undo:{string:"M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z",bbox:{x:0.875,y:6.817,x2:29.54,y2:27.042158,width:28.665,height:20.225158}},"chevron-right":{string:"M10.129,22.186 16.316,15.999 10.129,9.812 13.665,6.276 23.389,15.999 13.665,25.725z",bbox:{x:10.129,y:6.276,x2:23.389,y2:25.725,
width:13.26,height:19.449}},"chevron-left":{string:"M21.871,9.814 15.684,16.001 21.871,22.188 18.335,25.725 8.612,16.001 18.335,6.276z",bbox:{x:8.612,y:6.276,x2:21.871,y2:25.725,width:13.259,height:19.449}},"small-gear":{string:"M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z",
bbox:{x:0.667,y:0.667,x2:31.333,y2:31.333,width:30.666,height:30.666}},"question-bubble":{string:"M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.982,21.375h-1.969v-1.889h1.969V21.375zM16.982,17.469v0.625h-1.969v-0.769c0-2.321,2.641-2.689,2.641-4.337c0-0.752-0.672-1.329-1.553-1.329c-0.912,0-1.713,0.672-1.713,0.672l-1.12-1.393c0,0,1.104-1.153,3.009-1.153c1.81,0,3.49,1.121,3.49,3.009C19.768,15.437,16.982,15.741,16.982,17.469z",
bbox:{x:2,y:4.938,x2:30,y2:25.938,width:28,height:21}},roadmap:{string:"M23.188,3.735c0-0.975-0.789-1.766-1.766-1.766s-1.766,0.791-1.766,1.766s1.766,4.267,1.766,4.267S23.188,4.71,23.188,3.735zM20.578,3.734c0-0.466,0.378-0.843,0.844-0.843c0.467,0,0.844,0.377,0.844,0.844c0,0.466-0.377,0.843-0.844,0.843C20.956,4.578,20.578,4.201,20.578,3.734zM25.281,18.496c-0.562,0-1.098,0.046-1.592,0.122L11.1,13.976c0.199-0.181,0.312-0.38,0.312-0.59c0-0.108-0.033-0.213-0.088-0.315l8.41-2.239c0.459,0.137,1.023,0.221,1.646,0.221c1.521,0,2.75-0.485,2.75-1.083c0-0.599-1.229-1.083-2.75-1.083s-2.75,0.485-2.75,1.083c0,0.069,0.021,0.137,0.054,0.202L9.896,12.2c-0.633-0.188-1.411-0.303-2.265-0.303c-2.088,0-3.781,0.667-3.781,1.49c0,0.823,1.693,1.489,3.781,1.489c0.573,0,1.11-0.054,1.597-0.144l11.99,4.866c-0.19,0.192-0.306,0.401-0.306,0.623c0,0.188,0.096,0.363,0.236,0.532L8.695,25.415c-0.158-0.005-0.316-0.011-0.477-0.011c-3.241,0-5.87,1.037-5.87,2.312c0,1.276,2.629,2.312,5.87,2.312c3.241,0,5.87-1.034,5.87-2.312c0-0.22-0.083-0.432-0.229-0.633l10.265-5.214c0.37,0.04,0.753,0.066,1.155,0.066c2.414,0,4.371-0.771,4.371-1.723C29.65,19.268,27.693,18.496,25.281,18.496z",
bbox:{x:2.348,y:1.969,x2:29.65,y2:30.028,width:27.302,height:28.059}},play:{string:"m 58.250001,41.61219 0,40 34.69375,-20.03045 z",bbox:{x:58.250001,y:41.61219,x2:92.94375099999999,y2:81.61219,width:34.693749999999994,height:40}},unplay:{string:"m 74.987245,22.583592 0,39.978487 L 40,42.362183 z",bbox:{x:40,y:22.583592,x2:74.987245,y2:62.562079,width:34.987245,height:39.978487}},end:{string:"M21.167,5.5,21.167,13.681,6.684,5.318,6.684,25.682,21.167,17.318,21.167,25.5,25.5,25.5,25.5,5.5z",bbox:{x:6.684,
y:5.318,x2:25.5,y2:25.682,width:18.816,height:20.364}},start:{string:"M24.316,5.318,9.833,13.682,9.833,5.5,5.5,5.5,5.5,25.5,9.833,25.5,9.833,17.318,24.316,25.682z",bbox:{x:5.5,y:5.318,x2:24.316,y2:25.682,width:18.816,height:20.364}},arrowup:{string:"M23.963,20.834L17.5,9.64c-0.825-1.429-2.175-1.429-3,0L8.037,20.834c-0.825,1.429-0.15,2.598,1.5,2.598h12.926C24.113,23.432,24.788,22.263,23.963,20.834z",bbox:{x:7.684895,y:8.56825,x2:24.315105,y2:23.432,width:16.630209,height:14.86375}},arrowright:{string:"M11.166,23.963L22.359,17.5c1.43-0.824,1.43-2.175,0-3L11.166,8.037c-1.429-0.826-2.598-0.15-2.598,1.5v12.926C8.568,24.113,9.737,24.789,11.166,23.963z",
bbox:{x:8.568,y:7.684457,x2:23.4315,y2:24.315543,width:14.8635,height:16.631086}},arrowleft:{string:"M20.834,8.037L9.641,14.5c-1.43,0.824-1.43,2.175,0,3l11.193,6.463c1.429,0.826,2.598,0.15,2.598-1.5V9.537C23.432,7.887,22.263,7.211,20.834,8.037z",bbox:{x:8.5685,y:7.684457,x2:23.432,y2:24.315543,width:14.8635,height:16.631086}},detour:{string:"M29.342,15.5l-7.556-4.363v2.614H18.75c-1.441-0.004-2.423,1.002-2.875,1.784c-0.735,1.222-1.056,2.561-1.441,3.522c-0.135,0.361-0.278,0.655-0.376,0.817c-1.626,0-0.998,0-2.768,0c-0.213-0.398-0.571-1.557-0.923-2.692c-0.237-0.676-0.5-1.381-1.013-2.071C8.878,14.43,7.89,13.726,6.75,13.75H2.812v3.499c0,0,0.358,0,1.031,0h2.741c0.008,0.013,0.018,0.028,0.029,0.046c0.291,0.401,0.634,1.663,1.031,2.888c0.218,0.623,0.455,1.262,0.92,1.897c0.417,0.614,1.319,1.293,2.383,1.293H11c2.25,0,1.249,0,3.374,0c0.696,0.01,1.371-0.286,1.809-0.657c1.439-1.338,1.608-2.886,2.13-4.127c0.218-0.608,0.453-1.115,0.605-1.314c0.006-0.01,0.012-0.018,0.018-0.025h2.85v2.614L29.342,15.5zM10.173,14.539c0.568,0.76,0.874,1.559,1.137,2.311c0.04,0.128,0.082,0.264,0.125,0.399h2.58c0.246-0.697,0.553-1.479,1.005-2.228c0.252-0.438,0.621-0.887,1.08-1.272H9.43C9.735,14.003,9.99,14.277,10.173,14.539z",
bbox:{x:2.812,y:11.137,x2:29.342,y2:23.37325,width:26.53,height:12.23625}},checkbox:{string:"M26,27.5H6c-0.829,0-1.5-0.672-1.5-1.5V6c0-0.829,0.671-1.5,1.5-1.5h20c0.828,0,1.5,0.671,1.5,1.5v20C27.5,26.828,26.828,27.5,26,27.5zM7.5,24.5h17v-17h-17V24.5z",bbox:{x:4.5,y:4.5,x2:27.5,y2:27.5,width:23,height:23}},edit:{string:"M27.87,7.863L23.024,4.82l-7.889,12.566l4.842,3.04L27.87,7.863zM14.395,21.25l-0.107,2.855l2.527-1.337l2.349-1.24l-4.672-2.936L14.395,21.25zM29.163,3.239l-2.532-1.591c-0.638-0.401-1.479-0.208-1.882,0.43l-0.998,1.588l4.842,3.042l0.999-1.586C29.992,4.481,29.802,3.639,29.163,3.239zM25.198,27.062c0,0.275-0.225,0.5-0.5,0.5h-19c-0.276,0-0.5-0.225-0.5-0.5v-19c0-0.276,0.224-0.5,0.5-0.5h13.244l1.884-3H5.698c-1.93,0-3.5,1.57-3.5,3.5v19c0,1.93,1.57,3.5,3.5,3.5h19c1.93,0,3.5-1.57,3.5-3.5V11.097l-3,4.776V27.062z",
bbox:{x:2.198,y:1.4388,x2:29.80125,y2:30.562,width:27.60325,height:29.12316}},ff:{string:"M25.5,15.5,15.2,9.552,15.2,15.153,5.5,9.552,5.5,21.447,15.2,15.847,15.2,21.447z",bbox:{}},rw:{string:"M5.5,15.499,15.8,21.447,15.8,15.846,25.5,21.447,25.5,9.552,15.8,15.152,15.8,9.552z",bbox:{}},"jump-left-arrow":{string:"M 179.229,182.397 V 127.433 L 50,256.445 179.229,385.455 v -54.964 h 96.773 V 182.397 h -96.773 z m 123.385,0 h 47.184 V 330.491 H 302.614 V 182.397 z m 73.794,0 h 35.388 V 330.491 H 376.408 V 182.397 z m 62,0 H 462 V 330.491 H 438.408 V 182.397 z",
bbox:{x:50,y:127.433,x2:462,y2:385.455,width:412,height:258.022}},"jump-right-arrow":{string:"M332.771,182.397v-54.964L462,256.445l-129.229,129.01v-54.964h-96.773V182.397H332.771z    M209.386,182.397h-47.184v148.094h47.184V182.397z M135.592,182.397h-35.388v148.094h35.388V182.397z M73.592,182.397H50v148.094   h23.592V182.397z",bbox:{x:50,y:127.433,x2:462,y2:385.455,width:412,height:258.022}},"undo-problem-move":{string:"m 256,50 c 113.771,0 206,92.229 206,206 0,113.771 -92.229,206 -206,206 C 142.229,462 50,369.771 50,256 50,142.229 142.229,50 256,50 z m 58.399,329.6 V 132.4 L 135.6,256.001 314.399,379.6 z",
bbox:{x:50,y:50,x2:462,y2:462,width:412,height:412}},multiopen:{string:"m 130,73.862183 6.5,-13 6.5,13 z M 70.709141,37.871643 c -5.658849,0 -10.21875,4.412745 -10.21875,9.90625 l 0,43.3125 c 0,5.493505 4.559901,9.906247 10.21875,9.906247 l 44.624999,0 c 5.65885,0 10.21875,-4.412742 10.21875,-9.906247 l 0,-43.3125 c 0,-5.493505 -4.5599,-9.90625 -10.21875,-9.90625 l -44.624999,0 z m 2.0625,3.125 40.468749,0 c 5.12994,0 9.25,3.959703 9.25,8.90625 l 0,39 c 0,4.946547 -4.12006,8.9375 -9.25,8.9375 l -40.468749,0 c -5.129943,0 -9.25,-3.990953 -9.25,-8.9375 l 0,-39 c 0,-4.946547 4.120057,-8.90625 9.25,-8.90625 z",
bbox:{x:60.490391,y:37.871643,x2:143,y2:100.99664,width:82.509609,height:63.124997},subboxName:"multiopen-boxonly-inside"},"multiopen-boxonly":{string:"m 71.1875,38.25 c -5.658849,0 -10.21875,4.412745 -10.21875,9.90625 l 0,43.3125 c 0,5.493505 4.559901,9.90625 10.21875,9.90625 l 44.625,0 c 5.65885,0 10.21875,-4.412745 10.21875,-9.90625 l 0,-43.3125 c 0,-5.493505 -4.5599,-9.90625 -10.21875,-9.90625 l -44.625,0 z m 2.0625,3.125 40.46875,0 c 5.12994,0 9.25,3.959703 9.25,8.90625 l 0,39 c 0,4.946547 -4.12006,8.9375 -9.25,8.9375 l -40.46875,0 c -5.129943,0 -9.25,-3.990953 -9.25,-8.9375 l 0,-39 C 64,45.334703 68.120057,41.375 73.25,41.375 z",
bbox:{x:60.96875,y:38.25,x2:126.03125,y2:101.375,width:65.0625,height:63.125},subboxName:"multiopen-boxonly-inside"},"multiopen-boxonly-inside":{string:"m 73.259825,41.362183 40.445075,0 c 5.12994,0 9.25982,3.982238 9.25982,8.928785 l 0,38.999149 c 0,4.946547 -4.12988,8.928786 -9.25982,8.928786 l -40.445075,0 C 68.129882,98.218903 64,94.236664 64,89.290117 l 0,-38.999149 c 0,-4.946547 4.129882,-8.928785 9.259825,-8.928785 z",bbox:{x:64,y:41.362183,x2:122.96472,y2:98.218903,width:58.96472,height:56.85672}},
twostones:{string:"m 42.894737,29.335869 c 0,6.540213 -5.301891,11.842106 -11.842105,11.842106 -6.540214,0 -11.842105,-5.301893 -11.842105,-11.842106 0,-6.540214 5.301891,-11.842105 11.842105,-11.842105 6.540214,0 11.842105,5.301891 11.842105,11.842105 z M 31.052632,16.309553 c -7.194236,0 -13.026316,5.83208 -13.026316,13.026316 0,7.194233 5.83208,13.026314 13.026316,13.026314 3.733917,0 7.098575,-1.575815 9.473684,-4.092928 2.375029,2.516206 5.740532,4.092928 9.473684,4.092928 7.194235,0 13.026316,-5.832081 13.026316,-13.026314 0,-7.194236 -5.832081,-13.026316 -13.026316,-13.026316 -3.733152,0 -7.098655,1.56932 -9.473684,4.085526 -2.374906,-2.51483 -5.741698,-4.085526 -9.473684,-4.085526 z",
bbox:{x:18.026316,y:16.309553,x2:63.026316,y2:42.362183,width:45,height:26.05263}},bstone:{string:"m 105.05587,69.988831 a 23.738585,23.738585 0 1 1 -47.477171,0 23.738585,23.738585 0 1 1 47.477171,0 z",bbox:{x:57.578699,y:46.2148296,x2:105.05587,y2:93.7628323,width:47.477171,height:47.548002735}},wstone:{string:"M 107.5 37.375 C 81.266474 37.375 60 58.641474 60 84.875 C 60 111.10853 81.266474 132.375 107.5 132.375 C 133.73353 132.375 155 111.10853 155 84.875 C 155 58.641474 133.73353 37.375 107.5 37.375 z M 107.5 42.375 C 130.9721 42.375 150 61.402898 150 84.875 C 150 108.3471 130.9721 127.375 107.5 127.375 C 84.027898 127.375 65 108.3471 65 84.875 C 65 61.402898 84.027898 42.375 107.5 42.375 z",
bbox:{x:60,y:37.375,x2:155,y2:132.375,width:95,height:95}},bstone_a:{string:"M 107.5 37.375 C 81.266474 37.375 60 58.641474 60 84.875 C 60 111.10853 81.266474 132.375 107.5 132.375 C 133.73353 132.375 155 111.10853 155 84.875 C 155 58.641474 133.73353 37.375 107.5 37.375 z M 102.78125 52.53125 L 111.96875 52.53125 L 134.75 112.375 L 126.34375 112.375 L 120.90625 97 L 93.90625 97 L 88.46875 112.375 L 79.9375 112.375 L 102.78125 52.53125 z M 107.34375 60.5 L 96.375 90.28125 L 118.375 90.28125 L 107.34375 60.5 z",
bbox:{x:60,y:37.375,x2:155,y2:132.375,width:95,height:95}},bstone_1:{string:"M 107.5 37.375 C 81.266474 37.375 60 58.641474 60 84.875 C 60 111.10853 81.266474 132.375 107.5 132.375 C 133.73353 132.375 155 111.10853 155 84.875 C 155 58.641474 133.73353 37.375 107.5 37.375 z M 106.96875 52.4375 L 116.21875 52.4375 L 116.21875 112.21875 L 104.8125 112.21875 L 104.8125 69.21875 C 100.64371 73.116859 95.751353 75.975961 90.09375 77.84375 L 90.09375 67.5 C 93.071433 66.525528 96.289216 64.675791 99.78125 61.96875 C 103.27325 59.23474 105.66937 56.064927 106.96875 52.4375 z",
bbox:{x:60,y:37.375,x2:155,y2:132.375,width:95,height:95}},bstone_triangle:{string:"M 107.5 37.375 C 81.266474 37.375 60 58.641474 60 84.875 C 60 111.10853 81.266474 132.375 107.5 132.375 C 133.73353 132.375 155 111.10853 155 84.875 C 155 58.641474 133.73353 37.375 107.5 37.375 z M 107.8125 45.875 L 143.28125 107.3125 L 72.375 107.3125 L 107.8125 45.875 z M 107.78125 54.53125 L 80.3125 102.15625 L 135.28125 102.15625 L 107.78125 54.53125 z",bbox:{x:60,y:37.375,x2:155,y2:132.375,width:95,height:95}},
bstone_square:{string:"M 107.5 37.375 C 81.266474 37.375 60 58.641474 60 84.875 C 60 111.10853 81.266474 132.375 107.5 132.375 C 133.73353 132.375 155 111.10853 155 84.875 C 155 58.641474 133.73353 37.375 107.5 37.375 z M 76.0625 53.40625 L 139.21875 53.40625 L 139.21875 116.5625 L 76.0625 116.5625 L 76.0625 53.40625 z M 80.15625 57.59375 L 80.15625 112.34375 L 134.875 112.34375 L 134.875 57.59375 L 80.15625 57.59375 z",bbox:{x:60,y:37.375,x2:155,y2:132.375,width:95,height:95}},eraser:{string:"M 115 32.375 L 70.21875 87.40625 L 95.15625 112.375 L 140 57.375 L 115 32.375 z M 115 38.25 L 135 57.375 L 95 107.375 L 75 87.375 L 115 38.25 z",
bbox:{x:70.21875,y:37.375,x2:140,y2:112.375,width:69.78125,height:80}},"nostone-xmark":{string:"M462,256c0,113.771-92.229,206-206,206S50,369.771,50,256S142.229,50,256,50S462,142.229,462,256z M422,256c0-91.755-74.258-166-166-166c-91.755,0-166,74.259-166,166c0,91.755,74.258,166,166,166C347.755,422,422,347.741,422,256z M325.329,362.49l-67.327-67.324l-67.329,67.332l-36.164-36.186l67.314-67.322l-67.321-67.317l36.185-36.164l67.31,67.301 l67.3-67.309l36.193,36.17l-67.312,67.315l67.32,67.31L325.329,362.49z",
bbox:{x:50,y:50,x2:462,y2:462,width:412,height:412}}};glift.displays.icons.wrappedIcon=function(a){return new glift.displays.icons._WrappedIcon(a)};glift.displays.icons.wrapIcons=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if("string"===glift.util.typeOf(d))b.push(glift.displays.icons.wrappedIcon(d));else if("array"===glift.util.typeOf(d)){for(var e=glift.displays.icons.wrappedIcon("multiopen"),f=0;f<d.length;f++)e.addAssociatedIcon(d[f]);b.push(e)}}return b};
glift.displays.icons.validateIcon=function(a){if(void 0===a||void 0===glift.displays.icons.svg[a])throw"Icon unknown: ["+a+"]";return a};
glift.displays.icons._WrappedIcon=function(a){this.iconName=glift.displays.icons.validateIcon(a);a=glift.displays.icons.svg[a];this.iconStr=a.string;this.originalBbox=glift.displays.bboxFromPts(glift.util.point(a.bbox.x,a.bbox.y),glift.util.point(a.bbox.x2,a.bbox.y2));this.associatedIcons=[];this.activeAssociated=0;this.bbox=this.originalBbox;this.subboxIcon=this.elementId=this.transformObj=void 0;void 0!==a.subboxName&&this.setSubboxIcon(a.subboxName)};
glift.displays.icons._WrappedIcon.prototype={addAssociatedIcon:function(a){a=glift.displays.icons.wrappedIcon(a);this.associatedIcons.push(a);return a},_addAssociatedWrapped:function(a){if(void 0===a.originalBbox)throw"Wrapped icon not actually a wrapped icon: "+a;this.associatedIcons.push(a);return a},clearAssociatedIcons:function(){var a=this.associatedIcons;this.associatedIcons=[];return a},getAssociated:function(a){a=a||this.activeAssociated;return this.associatedIcons[a]},getActive:function(){return this.associatedIcons[this.activeAssociated]},
setActive:function(a){for(var b=0,c=this.associatedIcons.length;b<c;b++)this.associatedIcons[b].iconName===a&&(this.activeAssociated=b);return this},setElementId:function(a){this.elementId=a;return this},setSubboxIcon:function(a){return this.subboxIcon=glift.displays.icons.wrappedIcon(a)},centerWithinSubbox:function(a,b,c){if(void 0===this.subboxIcon)throw"No subbox defined, so cannot centerWithin.";b=glift.displays.gui.centerWithin(this.subboxIcon.bbox,a.bbox,b,c);a.performTransform(b.transform);
return a},centerWithinIcon:function(a,b,c){b=glift.displays.gui.centerWithin(this.bbox,a.bbox,b,c);a.performTransform(b.transform);return a},performTransform:function(a){a.scale&&(this.bbox=this.bbox.scale(a.scale));a.xMove&&a.yMove&&(this.bbox=this.bbox.translate(a.xMove,a.yMove));void 0!==this.subboxIcon&&this.subboxIcon.performTransform(a);this.transformObj=a;return this},resetTransform:function(){this.bbox=this.originalBbox;this.transformObj=void 0;return this},transformString:function(){return void 0!=
this.transformObj?"translate("+this.transformObj.xMove+","+this.transformObj.yMove+") scale("+this.transformObj.scale+")":""},rewrapIcon:function(){return glift.displays.icons.wrappedIcon(this.iconName)}};glift.displays.svg={};
glift.displays.svg.pathutils={move:function(a,b){return"M"+a+" "+b},movePt:function(a){return glift.displays.svg.pathutils.move(a.x(),a.y())},lineRel:function(a,b){return"l"+a+" "+b},lineRelPt:function(a){return glift.displays.svg.pathutils.lineRel(a.x(),a.y())},lineAbs:function(a,b){return"L"+a+" "+b},lineAbsPt:function(a){return glift.displays.svg.pathutils.lineAbs(a.x(),a.y())}};glift.displays.svg.createObj=function(a,b){return new glift.displays.svg.SvgObj(a,b)};
glift.displays.svg.svg=function(a){return(new glift.displays.svg.SvgObj("svg",a)).attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg")};glift.displays.svg.circle=function(a){return new glift.displays.svg.SvgObj("circle",a)};glift.displays.svg.path=function(a){return new glift.displays.svg.SvgObj("path",a)};glift.displays.svg.rect=function(a){return new glift.displays.svg.SvgObj("rect",a)};glift.displays.svg.image=function(a){return new glift.displays.svg.SvgObj("image",a)};
glift.displays.svg.text=function(a){return new glift.displays.svg.SvgObj("text",a)};glift.displays.svg.group=function(){return new glift.displays.svg.SvgObj("g")};glift.displays.svg.SvgObj=function(a,b){this._type=a;this._attrMap=b||{};this._children=[];this._idMap={};this._text="";this._data=void 0};
glift.displays.svg.SvgObj.prototype={attachToParent:function(a){(a=document.getElementById(a))&&a.appendChild(this.asElement())},removeFromDom:function(){if(this.attr("id")){var a=document.getElementById(this.attr("id"));a&&a.parentNode.removeChild(a)}return this},asElement:function(){var a=document.createElementNS("http://www.w3.org/2000/svg",this._type),b;for(b in this._attrMap)"xlink:href"===b?a.setAttributeNS("http://www.w3.org/1999/xlink","href",this._attrMap[b]):a.setAttribute(b,this._attrMap[b]);
"text"===this._type&&(b=document.createTextNode(this._text),a.appendChild(b));b=0;for(var c=this._children.length;b<c;b++)a.appendChild(this._children[b].asElement());return a},render:function(){var a="<"+this._type,b;for(b in this._attrMap)a+=" "+b+'="'+this._attrMap[b]+'"';a+=">"+this._text;if(0<this._children.length){a=[a];b=0;for(var c=this._children.length;b<c;b++)a.push(this._children[b].render());a.push("</"+this._type+">");a=a.join("\n")}else a+="</"+this._type+">";return a},attr:function(a,
b){return void 0!==b?(this._attrMap[a]=b,this):this._attrMap[a]},attrObj:function(a){return void 0!==a&&"object"===glift.util.typeOf(a)?(this._attrMap=a,this):this._attrMap},updateAttrInDom:function(a){var b=document.getElementById(this.attr("id"));b&&a&&this.attr(a)&&b.setAttribute(a,this.attr(a));return this},data:function(a){return void 0!==a?(this._data=a,this):this._data},text:function(a){return void 0!==a?(this._text=""+a,this):this._text},child:function(a){return this._idMap[a]},rmChild:function(a){delete this._idMap[a];
return this},children:function(){return this._children},emptyChildren:function(){this._children=[];return this},emptyChildrenAndUpdate:function(){this.emptyChildren();for(var a=document.getElementById(this.attr("id"));a&&a.firstChild;)a.removeChild(a.firstChild);return this},append:function(a){void 0!==a.attr("id")&&(this._idMap[a.attr("id")]=a);this._children.push(a);return this},appendNew:function(a,b){var c=glift.displays.svg.createObj(a,b);return this.append(c)},appendAndAttach:function(a){this.append(a);
this.attr("id")&&a.attachToParent(this.attr("id"))},copyNoChildren:function(){var a={},b;for(b in this._attrMap)a[b]=this._attrMap[b];return glift.displays.svg.createObj(this._type,a)}};glift.rules={};
glift.rules.autonumber=function(a){var b=/\d+/,c=/0\d/;a.recurseFromRoot(function(a){if(a.properties().contains("C")&&""!==a.properties().getOneValue("C")){for(var e=a.properties().getAllValues("LB"),f={},g=0;e&&g<e.length;g++){var h=e[g].split(":");b.test(h[1])||(f[h[0]]=h[1])}for(var g=glift.rules.treepath.findNextMovesPath(a),h=g.movetree,k=glift.rules.goban.getFromMoveTree(h).goban,e=a.onMainline()?h.node().getNodeNum()+1:h.movesToMainline()+1,k=glift.rules.treepath.applyNextMoves(h,k,g.nextMoves),
g=h=0,k=k.stones;g<k.length;g++){var m=k[g];m.collision||(m=m.point.toSgfCoord(),f[m]=e+h,h++)}var e=[],l;for(l in f)g=f[l]+"",2<g.length&&(h=g.substring(g.length-2,g.length),"00"!==h&&(g=h),2===g.length&&c.test(g)&&(g=g.charAt(g.length-1))),e.push(l+":"+g);0===e.length?a.properties().remove("LB"):a.properties().set("LB",e);glift.rules.removeCollidingLabels(a,f)}})};
glift.rules.removeCollidingLabels=function(a,b){for(var c=["TR","SQ"],d=0;d<c.length;d++){var e=c[d];if(a.properties().contains(e)){for(var f=a.properties().getAllValues(e),g=[],h=0;h<f.length;h++){var k=f[h];b[k]||g.push(k)}0===g.length?a.properties().remove(e):a.properties().set(e,g)}}};
glift.rules.clearnumbers=function(a){var b=/\d+/;a.recurseFromRoot(function(a){if(a.properties().contains("LB")){for(var d=a.properties().getAllValues("LB"),e=[],f=0;d&&f<d.length;f++){var g=d[f].split(":");b.test(g[1])||e.push(d[f])}0===e.length?a.properties().remove("LB"):a.properties().set("LB",e)}})};
(function(){glift.rules.goban={getInstance:function(b){return new a(b||19)},getFromMoveTree:function(b,c){var f=new a(b.getIntersections());c=c||b.treepathToHere();var g=b.getTreeFromRoot(),h=[];f.loadStonesFromMovetree(g);for(var k=0;k<c.length;k++)g.moveDown(c[k]),h.push(f.loadStonesFromMovetree(g));return{goban:f,captures:h}}};var a=function(a){if(!a||0>=a)throw"Invalid Intersections. Was: "+a;this.ints=a||19;for(var b=[],c=0;c<a;c++){for(var g=[],h=0;h<a;h++)g[h]=glift.enums.states.EMPTY;b[c]=
g}this.stones=b};a.prototype={intersections:function(){return this.ints},getStone:function(a){return this.stones[a.y()][a.x()]},getAllPlacedStones:function(){for(var a=[],b=0;b<this.stones.length;b++)for(var c=this.stones[b],g=0;g<c.length;g++){var h=glift.util.point(g,b),k=this.getStone(h);k!==glift.enums.states.BLACK&&k!==glift.enums.states.WHITE||a.push({point:h,color:k})}return a},placeable:function(a,b){return this.inBounds(a)&&this.getStone(a)===glift.enums.states.EMPTY},outBounds:function(a){return glift.util.outBounds(a.x(),
this.ints)||glift.util.outBounds(a.y(),this.ints)},inBounds:function(a){return glift.util.inBounds(a.x(),this.ints)&&glift.util.inBounds(a.y(),this.ints)},clearStone:function(a){this._setColor(a,glift.enums.states.EMPTY)},clearSome:function(a){for(var b=0;b<a.length;b++)this.clearStone(a[b])},_setColor:function(a,b){this.stones[a.y()][a.x()]=b},testAddStone:function(a,b){var c=this.addStone(a,b);this.clearStone(a);for(var g=glift.util.colors.oppositeColor(b),h=0;h<c.captures.length;h++)this._setColor(c.captures[h],
g);return c.successful},addStone:function(a,e){if(!glift.util.colors.isLegalColor(e))throw"Unknown color: "+e;if(this.outBounds(a)||!this.placeable(a))return new c(!1);this._setColor(a,e);var f=new b,g=glift.util.colors.oppositeColor(e);this._getCaptures(f,glift.util.point(a.x()+1,a.y()),g);this._getCaptures(f,glift.util.point(a.x()-1,a.y()),g);this._getCaptures(f,glift.util.point(a.x(),a.y()-1),g);this._getCaptures(f,glift.util.point(a.x(),a.y()+1),g);if(0>=f.numCaptures&&(this._getCaptures(f,a,
e),0<f.numCaptures))return this.clearStone(a),new c(!1);f=f.getCaptures();this.clearSome(f);return new c(!0,f)},_getCaptures:function(a,b,c){this._findConnected(a,b,c);0>=a.liberties&&a.consideringToCaptures();a.clearExceptCaptures()},_findConnected:function(a,b,c){var g=glift.util;if(void 0===a.seen[b.hash()]&&!this.outBounds(b)){a.seen[b.hash()]=!0;var h=this.getStone(b);if(h===glift.enums.states.EMPTY)a.liberties++;else if(h!==g.colors.oppositeColor(c))if(h===c)a.considering.push(b),this._findConnected(a,
g.point(b.x()+1,b.y()),c),this._findConnected(a,g.point(b.x()-1,b.y()),c),this._findConnected(a,g.point(b.x(),b.y()+1),c),this._findConnected(a,g.point(b.x(),b.y()-1),c);else throw"Unknown color error: "+h;}},loadStonesFromMovetree:function(a){for(var b=[glift.enums.states.BLACK,glift.enums.states.WHITE],c={BLACK:[],WHITE:[]},g=0;g<b.length;g++)for(var h=b[g],k=a.properties().getPlacementsAsPoints(h),m=0,l=k.length;m<l;m++)this._loadStone({point:k[m],color:h},c);this._loadStone(a.properties().getMove(),
c);return c},_loadStone:function(a,b){if(a&&void 0!==a.point){var c=this.addStone(a.point,a.color);if(c.successful)for(var g=glift.util.colors.oppositeColor(a.color),h=0,k=c.captures.length;h<k;h++)b[g].push(c.captures[h])}},unloadStones:function(a,b){for(var c in a)for(var g=0;g<a[c].length;g++)this.clearStone(a[c][g]);for(c in b)for(g=0;g<b[c].length;g++)this.addStone(b[c][g],c)},_debug:function(){glift.util.logz(this.stones)}};var b=function(){this.toCapture={};this.numCaptures=0;this.considering=
[];this.seen={};this.liberties=0};b.prototype={clearExceptCaptures:function(){this.considering=[];this.seen={};this.liberties=0},consideringToCaptures:function(){for(var a=0;a<this.considering.length;a++){var b=this.considering[a];void 0===this.toCapture[b.hash()]&&(this.toCapture[b.hash()]=!0,this.numCaptures++)}},addLiberties:function(a){this.liberties+=a},addSeen:function(a){this.seen[a.hash()]=!0},getCaptures:function(){var a=[],b;for(b in this.toCapture)a.push(glift.util.pointFromHash(b));return a}};
var c=function(a,b){this.captures=(this.successful=a)?b:[]}})();glift.rules.movenode=function(a,b,c,d){return new glift.rules._MoveNode(a,b,c,d)};glift.rules._MoveNode=function(a,b,c,d){this._properties=a||glift.rules.properties();this.children=b||[];this._nodeId=c||{nodeNum:0,varNum:0};this._parentNode=d;this._mainline=!1};
glift.rules._MoveNode.prototype={properties:function(){return this._properties},_setNodeId:function(a,b){this._nodeId={nodeNum:a,varNum:b};return this},getNodeNum:function(){return this._nodeId.nodeNum},getVarNum:function(){return this._nodeId.varNum},numChildren:function(){return this.children.length},addChild:function(){this.children.push(glift.rules.movenode(glift.rules.properties(),[],{nodeNum:this.getNodeNum()+1,varNum:this.numChildren()},this));return this},getChild:function(a){return void 0===
a?this.children[0]:this.children[a]},getParent:function(){return this._parentNode?this._parentNode:null},renumber:function(){numberMoves(this,this._nodeId.nodeNum,this._nodeId.varNum);return this}};var numberMoves=function(a,b,c){a._setNodeId(b,c);for(c=0;c<a.children.length;c++)numberMoves(a.children[c],b+1,c);return a};
glift.rules.movetree={getInstance:function(a){var b=new glift.rules._MoveTree(glift.rules.movenode());void 0!==a&&b._setIntersections(a);return b},getFromSgf:function(a,b){b=b||[];if(void 0===a||""===a)return glift.rules.movetree.getInstance(19);glift.util.majorPerfLog("Before SGF parsing in movetree");var c=glift.sgf.parse(a);glift.util.majorPerfLog("After SGF parsing in movetree");for(var d=0;d<b.length;d++)c.moveDown(b[d]);return c},getFromNode:function(a){return new glift.rules._MoveTree(a)},
searchMoveTreeDFS:function(a,b){b(a);for(var c=0;c<a.node().numChildren();c++)glift.rules.movetree.searchMoveTreeDFS(a.moveDown(c),b);a.moveUp()}};glift.rules._MoveTree=function(a,b){this._rootNode=a;this._currentNode=b||a;this._markedMainline=!1};
glift.rules._MoveTree.prototype={node:function(){return this._currentNode},properties:function(){return this.node().properties()},moveDown:function(a){a=void 0===a?0:a;void 0!==this.node().getChild(a)&&(this._currentNode=this.node().getChild(a));return this},moveUp:function(){var a=this._currentNode.getParent();a&&(this._currentNode=a);return this},getCurrentPlayer:function(){for(var a=glift.enums.states,b=this._currentNode,c=b.properties().getMove();!c;){b=b.getParent();if(!b)return a.BLACK;c=b.properties().getMove()}return c?
c.color===a.BLACK?a.WHITE:a.BLACK:a.BLACK},newTreeRef:function(){return new glift.rules._MoveTree(this._rootNode,this._currentNode)},getTreeFromRoot:function(a){var b=glift.rules.movetree.getFromNode(this._rootNode);if(a&&"array"===glift.util.typeOf(a))for(var c=0,d=a.length;c<d&&0<b.node().numChildren();c++)b.moveDown(a[c]);return b},addNode:function(){this.node().addChild();this.moveDown(this.node().numChildren()-1);return this},deleteNode:function(){throw"Unfinished";},findNextMove:function(a,
b){for(var c=this.node().children,d=glift.sgf.colorToToken(b),e={},f=0;f<c.length;f++){var g=c[f];g.properties().contains(d)&&""!=g.properties().getOneValue(d)&&(e[g.properties().getAsPoint(d).hash()]=g.getVarNum())}return void 0!==e[a.hash()]?e[a.hash()]:null},getIntersections:function(){var a=this.getTreeFromRoot(),b=glift.sgf.allProperties;return a.properties().contains(b.SZ)?parseInt(a.properties().getAllValues(b.SZ)):19},getLastMove:function(){return this.properties().getMove()},movesToMainline:function(){for(var a=
this.newTreeRef(),b=0;!a.onMainline()&&a.node().getParent();b++)a.moveUp();return b},nextMoves:function(){for(var a=this.node(),b=[],c=0;c<a.numChildren();c++){var d=a.getChild(c).properties().getMove();d&&b.push(d)}return b},onMainline:function(){if(!this._markedMainline){var a=this.getTreeFromRoot();for(a.node()._mainline=!0;0<a.node().numChildren();)a.moveDown(),a.node()._mainline=!0;this._markedMainline=!0}return this.node()._mainline},recurse:function(a){glift.rules.movetree.searchMoveTreeDFS(this,
a)},recurseFromRoot:function(a){glift.rules.movetree.searchMoveTreeDFS(this.getTreeFromRoot(),a)},toSgf:function(){return this._toSgfBuffer(this.getTreeFromRoot().node(),[]).join("")},treepathToHere:function(){for(var a=[],b=this.newTreeRef();b.node().getParent();)a.push(b.node().getVarNum()),b.moveUp();return a.reverse()},_debugLog:function(a){void 0===a&&(a="  ");glift.util.logz(a+this.node(b).getVarNum()+"-"+this.node(b).getNodeNum());for(var b=0;b<this.node().numChildren();b++)this.moveDown(b),
this._debugLog(a),this.moveUp()},_setIntersections:function(a){var b=this.getTreeFromRoot(),c=glift.sgf.allProperties;b.properties().contains(c.SZ)||this.properties().add(c.SZ,a+"");return this},_toSgfBuffer:function(a,b){a.getParent()&&b.push("\n");(!a.getParent()||1<a.getParent().numChildren())&&b.push("(");b.push(";");for(var c in a.properties().propMap){var d=a.properties().getAllValues(c),e=c;if(0<d.length)for(var f=0;f<d.length;f++)e+="["+d[f]+"]";else e+="[]";b.push(e)}f=0;for(c=a.numChildren();f<
c;f++)this._toSgfBuffer(a.getChild(f),b);(!a.getParent()||1<a.getParent().numChildren())&&b.push(")");return b}};
glift.rules.problems={isCorrectPosition:function(a,b){var c=glift.enums.problemResults;if(a.properties().matches(b))return c.CORRECT;for(var d=glift.rules.treepath.flattenMoveTree(a),e={},f=0;f<d.length;f++){for(var g=d[f],h=glift.rules.movetree.getFromNode(a.node()),k=!1,m=0;m<g.length;m++)h.moveDown(g[m]),h.properties().matches(b)&&(k=!0);k?e[c.CORRECT]=!0:e[c.INCORRECT]=!0}return e[c.CORRECT]&&!e[c.INCORRECT]?a.properties().matches(b)?c.CORRECT:c.INDETERMINATE:e[c.CORRECT]&&e[c.INCORRECT]?c.INDETERMINATE:
c.INCORRECT},correctNextMoves:function(a,b){for(var c=a.nextMoves(),d=glift.enums.problemResults.INCORRECT,e=[],f=0;f<c.length;f++)a.moveDown(f),glift.rules.problems.isCorrectPosition(a,b)!==d&&e.push(c[f]),a.moveUp();return e}};
(function(){glift.rules.properties=function(b){return new a(b)};var a=function(a){this.propMap=a||{}};a.prototype={add:function(a,c){glift.sgf.allProperties[a]||glift.util.logz("Warning! The property ["+a+"] is not valid and is not recognized in the SGF spec.");if("string"!==glift.util.typeOf(c)&&"array"!==glift.util.typeOf(c))c=c.toString();else if("array"===glift.util.typeOf(c))for(var d=0,e=c.length;d<e;d++)"string"!==glift.util.typeOf(c[d])&&(c[d]=c[d].toString());c="string"===glift.util.typeOf(c)?
[c]:c;this.contains(a)?this.propMap[a]=this.getAllValues(a).concat(c):this.propMap[a]=c;return this},getAllValues:function(a){return void 0===glift.sgf.allProperties[a]?null:this.propMap[a]?this.propMap[a].slice():null},getOneValue:function(a,c){c=void 0!==c&&"number"===typeof c&&0<=c?c:0;var d=this.getAllValues(a);return d&&1<=d.length?d[c]:null},getAsPoint:function(a,c){var d=this.getOneValue(a,c);return d?glift.util.pointFromSgfCoord(d):d},contains:function(a){return a in this.propMap},hasValue:function(a,
c){if(!this.contains(a))return!1;for(var d=this.getAllValues(a),e=0;e<d.length;e++)if(d[e]===c)return!0;return!1},remove:function(a){if(this.contains(a)){var c=this.getAllValues(a);delete this.propMap[a];return c}return null},removeOneValue:function(a,c){if(this.contains(a)){for(var d=this.getAllValues(a),e=-1,f=0,g=d.length;f<g;f++)if(d[f]===c){e=f;break}-1!==e&&(d.splice(e,1),this.set(a,d))}else return null},set:function(a,c){void 0!==a&&void 0!==c&&("string"===glift.util.typeOf(c)?this.propMap[a]=
[c]:"array"===glift.util.typeOf(c)&&(this.propMap[a]=c));return this},getPlacementsAsPoints:function(a){var c="";a===glift.enums.states.BLACK?c=glift.sgf.allProperties.AB:a===glift.enums.states.WHITE&&(c=glift.sgf.allProperties.AW);return""!==c&&this.contains(c)?glift.sgf.allSgfCoordsToPoints(this.getAllValues(c)):[]},getComment:function(){return this.contains("C")?this.getOneValue("C"):null},getMove:function(){var a=glift.enums.states.BLACK,c=glift.enums.states.WHITE;return this.contains("B")?""===
this.getOneValue("B")?{color:a}:{color:a,point:this.getAsPoint("B")}:this.contains("W")?""===this.getOneValue("W")?{color:c}:{color:c,point:this.getAsPoint("W")}:null},matches:function(a){for(var c in a)if(this.contains(c)){var d=a[c];if(0===d.length)return!0;for(var e=this.getAllValues(c),f=0,g=e.length;f<g;f++)for(var h=0,k=d.length;h<k;h++)if(-1!==e[f].indexOf(d[h]))return!0}return!1},getAllStones:function(){var a=glift.enums.states,c={},d=a.WHITE;c[a.BLACK]=this.getPlacementsAsPoints(a.BLACK);
c[d]=this.getPlacementsAsPoints(a.WHITE);(a=this.getMove())&&a.point&&c[a.color].push(a.point);return c}}})();
glift.rules.treepath={parseInitPosition:function(a){if(void 0===a)return[];if("number"===glift.util.typeOf(a))a=""+a;else{if("array"===glift.util.typeOf(a))return a;if("string"!==glift.util.typeOf(a))return[]}if("+"===a)return this.toEnd();var b=[],c=0;a=a.split("-");for(var d=0;d<a.length;d++){for(var e=a[d].split("."),f=0;f<e[0]-c;f++)b.push(0);c=e[0];for(f=1;f<e.length;f++){var g=e[f];if("+"===g.charAt(g.length-1))return g=g.slice(0,g.length-1),b.push(parseInt(g)),b=b.concat(glift.rules.treepath.toEnd());
b.push(parseInt(g));c++}}return b},toEnd:function(){if(void 0!==glift.rules.treepath._storedToEnd)return glift.rules.treepath._storedToEnd;for(var a=[],b=0;500>b;b++)a.push(0);glift.rules.treepath._storedToEnd=a;return glift.rules.treepath._storedToEnd},findNextMovesPath:function(a,b,c,d){b=b||a.treepathToHere();d=!1===d?!1:!0;a=a.getTreeFromRoot(b);b=c||40;for(var e=[],f=a.onMainline(),g=0;a.node().getParent()&&g<b;g++){var h=a.node().getVarNum();e.push(h);a.moveUp();if(d&&a.properties().getOneValue("C")&&
!c)break;if(!f&&a.onMainline()&&!c)break}e.reverse();return{movetree:a,treepath:a.treepathToHere(),nextMoves:e}},applyNextMoves:function(a,b,c){var d=glift.enums.states;a=a.newTreeRef();for(var e=[],f={},g=0;g<c.length;g++){a.moveDown(c[g]);var h=a.properties().getMove();if(h&&h.point&&h.color){var k=h.point.toString();b.getStone(h.point)!==d.EMPTY?h.collision=null:void 0!==f[k]&&(h.collision=f[k]);e.push(h);f[k]=g}}return{movetree:a,stones:e}},flattenMoveTree:function(a){for(var b=[],c=0;c<a.node().numChildren();c++){a.moveDown(c);
var d=glift.rules.treepath._flattenMoveTree(a,[]);a.moveUp();for(var e=0;e<d.length;e++)b.push(d[e])}return b},_flattenMoveTree:function(a,b){void 0===b&&(b=[]);b.push(a.node().getVarNum());for(var c=[],d=0;d<a.node().numChildren();d++){a.moveDown(d);var e=glift.rules.treepath._flattenMoveTree(a,b.slice()),c=c.concat(e);a.moveUp(d)}0==c.length&&c.push(b);return c}};
glift.sgf={colorToToken:function(a){if(a===glift.enums.states.WHITE)return"W";if(a===glift.enums.states.BLACK)return"B";throw"Unknown color-to-token conversion for: "+a;},colorToPlacement:function(a){if(a===glift.enums.states.WHITE)return"AW";if(a===glift.enums.states.BLACK)return"AB";throw"Unknown color-to-token conversion for: "+a;},markToProperty:function(a){var b=glift.sgf.allProperties;return{LABEL_ALPHA:b.LB,LABEL_NUMERIC:b.LB,LABEL:b.LB,XMARK:b.MA,SQUARE:b.SQ,CIRCLE:b.CR,TRIANGLE:b.TR}[a]||
null},propertyToMark:function(a){var b=glift.enums.marks;return{LB:b.LABEL,MA:b.XMARK,SQ:b.SQUARE,CR:b.CIRCLE,TR:b.TRIANGLE}[a]||null},allSgfCoordsToPoints:function(a){var b=[];if(!a)return b;for(var c=0;c<a.length;c++)b.push(glift.util.pointFromSgfCoord(a[c]));return b},convertFromLabelData:function(a){a=a.split(":");return{point:glift.util.pointFromSgfCoord(a[0]),value:a[1]}},convertFromLabelArray:function(a){for(var b=[],c=0;c<a.length;c++)b.push(glift.sgf.convertFromLabelData(a[c]));return b}};
glift.sgf.parse=function(a){var b={BEGINNING:1,PROPERTY:2,PROP_DATA:3,BETWEEN:4},c=/\s|\n/,d=/[A-Z]/,e=b.BEGINNING_BEFORE_PAREN,f=glift.rules.movetree.getInstance(),g=[],h=[],k=[],m="",l="",n=0,q=0,p=function(a){glift.sgf.parseError(n,q,l,a,!1)},r=function(){var a=g.join("");g=[];return a},s=function(){0<m.length&&(f.properties().add(m,h),h=[],m="")};(function(){for(var t=0;t<a.length;t++){q++;l=a.charAt(t);if("\n"===l&&(n++,q=0,e!==b.PROP_DATA))continue;switch(e){case b.BEGINNING_BEFORE_PAREN:"("===
l?(k.push(f.node().getNodeNum()),e=b.BEGINNING):c.test(l)||p("Unexpected character. Expected first non-whitespace char to be [(]");break;case b.BEGINNING:";"===l?e=b.BETWEEN:c.test(l)||p("Unexpected character. Expected char to be [;]");break;case b.PROPERTY:d.test(l)?(g.push(l),2<g.length&&p("Expected: length two property. Found: "+g)):"["===l?(m=r(),void 0===glift.sgf.allProperties[m]&&glift.sgf.parseError(n,q,l,"Unknown property: "+m,!0),e=b.PROP_DATA):c.test(l)?p("Unexpected whitespace in property name"):
p("Unexpected character in property name");break;case b.PROP_DATA:"]"===l&&"\\"===g[g.length-1]?g.push(l):"]"===l?(h.push(r()),e=b.BETWEEN):g.push(l);break;case b.BETWEEN:if(d.test(l))s(),g.push(l),e=b.PROPERTY;else if("["===l)0<m.length?e=b.PROP_DATA:p("Unexpected token.  Orphan property data.");else if("("===l)s(),k.push(f.node().getNodeNum());else if(")"===l){s();if(0===k.length){for(;0!==f.node().getNodeNum();)f.moveUp();return f}for(var v=k.pop();f.node().getNodeNum()!==v;)f.moveUp()}else";"===
l?(s(),f.addNode()):c.test(l)||p("Unknown token");break;default:p("Fatal Error: Unknown State!")}}0!==f.node().getNodeNum()&&p("Expected to end up at start.")})();return f};glift.sgf.parseError=function(a,b,c,d,e){a="SGF Parsing "+(e?"Warning":"Error")+": At line ["+a+"], column ["+b+"], char ["+c+"], "+d;if(e)glift.util.logz(a);else throw Error(a);};
glift.sgf.allProperties={AB:"AB",AE:"AE",AN:"AN",AP:"AP",AR:"AR",AS:"AS",AW:"AW",B:"B",BL:"BL",BM:"BM",BR:"BR",BS:"BS",BT:"BT",C:"C",CA:"CA",CH:"CH",CP:"CP",CR:"CR",DD:"DD",DM:"DM",DO:"DO",DT:"DT",EL:"EL",EV:"EV",EX:"EX",FF:"FF",FG:"FG",GB:"GB",GC:"GC",GM:"GM",GN:"GN",GW:"GW",HA:"HA",HO:"HO",ID:"ID",IP:"IP",IT:"IT",IY:"IY",KM:"KM",KO:"KO",L:"L",LB:"LB",LN:"LN",LT:"LT",M:"M",MA:"MA",MN:"MN",N:"N",OB:"OB",OH:"OH",OM:"OM",ON:"ON",OP:"OP",OT:"OT",OV:"OV",OW:"OW",PB:"PB",PC:"PC",PL:"PL",PM:"PM",PW:"PW",
RE:"RE",RG:"RG",RO:"RO",RU:"RU",SC:"SC",SE:"SE",SI:"SI",SL:"SL",SO:"SO",SQ:"SQ",ST:"ST",SU:"SU",SZ:"SZ",TB:"TB",TC:"TC",TE:"TE",TM:"TM",TR:"TR",TW:"TW",UC:"UC",US:"US",V:"V",VW:"VW",W:"W",WL:"WL",WR:"WR",WS:"WS",WT:"WT",MU:"MU"};glift.gib={};
glift.gib.parse=function(a){var b={1:"B",2:"W"},c=glift.rules.movetree.getInstance();a=a.split("\n");for(var d=1,e=0,f=a.length;e<f;e++){var g=a[e],h=g.substring(0,2);if("\\["===h)h=g.indexOf("="),h=g.substring(2,h),"GAMEWHITENAME"===h?c.properties().add("PW",g.substring(g.indexOf("GAMEWHITENAME")+13+1,g.length-2)):"GAMEBLACKNAME"===h&&c.properties().add("PB",g.substring(g.indexOf("GAMEBLACKNAME")+13+1,g.length-2));else if("ST"===h){2!==d&&(d=2);var k=g.split(" "),g=b[k[3]],h=parseInt(k[4]),k=18-
parseInt(k[5]);c.addNode().properties().add(g,glift.util.point(h,k).toSgfCoord())}}return c.getTreeFromRoot()};glift.controllers={};
(function(){glift.controllers.base=function(){return new a};var a=function(){this.sgfString="";this.initialPosition=[];this.problemConditions={};this.goban=this.movetree=this.treepath=void 0;this.captureHistory=[];this.currentMoveNumber=0};a.prototype={initOptions:function(a){if(void 0===a)throw"Options is undefined!  Can't create controller";this.sgfString=a.sgfString||"";this.initialPosition=a.initialPosition||[];this.problemConditions=a.problemConditions||void 0;this.initialize();this.extraOptions(a);
return this},extraOptions:function(a){},addStone:function(a,c){throw"Not Implemented";},recordCaptures:function(a){this.currentMoveNumber++;this.captureHistory.push(a);return this},initialize:function(){var a=glift.rules;this.treepath=a.treepath.parseInitPosition(this.initialPosition);this.currentMoveNumber=this.treepath.length;this.movetree=a.movetree.getFromSgf(this.sgfString,this.treepath);a=a.goban.getFromMoveTree(this.movetree,this.treepath);this.goban=a.goban;this.captureHistory=a.captures;
return this},getEntireBoardState:function(){return glift.bridge.intersections.getFullBoardData(this.movetree,this.goban,this.problemConditions)},getNextBoardState:function(){return glift.bridge.intersections.nextBoardData(this.movetree,this.getCaptures(),this.problemConditions)},getCaptures:function(){return 0===this.captureHistory.length?{BLACK:[],WHITE:[]}:this.captureHistory[this.currentMoveNumber-1]},canAddStone:function(a,c){return this.goban.placeable(a,c)},getCurrentPlayer:function(){return this.movetree.getCurrentPlayer()},
getIntersections:function(){return this.movetree.getIntersections()},nextMove:function(a){if(void 0===this.treepath[this.currentMoveNumber]||void 0!==a&&this.treepath[this.currentMoveNumber]!==a)if(a=void 0===a?0:a,0<=a&&a<=this.movetree.nextMoves().length-1)this.setNextVariation(a),this.movetree.moveDown(a);else return null;else this.movetree.moveDown(this.treepath[this.currentMoveNumber]);a=this.goban.loadStonesFromMovetree(this.movetree);this.recordCaptures(a);return this.getNextBoardState()},
prevMove:function(){if(0===this.currentMoveNumber)return null;var a=this.getCaptures(),c=this.movetree.properties().getAllStones();this.captureHistory=this.captureHistory.slice(0,this.currentMoveNumber-1);this.goban.unloadStones(c,a);this.currentMoveNumber=0===this.currentMoveNumber?this.currentMoveNumber:this.currentMoveNumber-1;this.movetree.moveUp();return glift.bridge.intersections.previousBoardData(this.movetree,c,a,this.problemConditions)},setNextVariation:function(a){this.treepath=this.treepath.slice(0,
this.currentMoveNumber);this.treepath.push(a%this.movetree.node().numChildren());return this},getNextVariation:function(){return this.treepath[this.currentMoveNumber]||0},toBeginning:function(){this.movetree=this.movetree.getTreeFromRoot();this.goban=glift.rules.goban.getFromMoveTree(this.movetree,[]).goban;this.captureHistory=[];this.currentMoveNumber=0;return this.getEntireBoardState()},toEnd:function(){for(;this.nextMove(););return this.getEntireBoardState()}}})();
glift.controllers.boardEditor=function(a){var b=glift.controllers,c=glift.util.beget(b.base());glift.util.setMethods(c,b.BoardEditorMethods);c.initOptions(a);return c};
glift.controllers.BoardEditorMethods={extraOptions:function(a){this._initLabelTrackers()},_initLabelTrackers:function(){var a=glift.enums.marks,b={},c={};this._ptTolabelMap={};for(var d=0;100>d;d++)b[d+1]=!0;for(d=0;26>d;d++){var e=""+String.fromCharCode(65+d);c[e]=!0}for(var e=[a.CIRCLE,a.LABEL,a.SQUARE,a.TRIANGLE,a.XMARK],f=/^[A-Z]$/,g=/^\d*$/,d=0;d<e.length;d++){var h=e[d],k=glift.sgf.markToProperty(h);if(k=this.movetree.properties().getAllValues(k))for(var m=0;m<k.length;m++){var l=k[m].split(":"),
n={mark:h},q=null;1<l.length&&(q=l[1],n.data=q,f.test(q)?n.mark=a.LABEL_ALPHA:g.test(q)&&(q=parseInt(q),n.mark=a.LABEL_NUMERIC));l=glift.util.pointFromSgfCoord(l[0]);this._ptTolabelMap[l.toString()]=n;b[q]&&delete b[q];c[q]&&delete c[q]}}this._alphaLabels=this._convertLabelMap(c);this._numericLabels=this._convertLabelMap(b)},_convertLabelMap:function(a){var b=[],c=/^\d+$/,d;for(d in a)c.test(d)?b.push(parseInt(d)):b.push(d);0<b.length&&"number"===glift.util.typeOf(b[0])?(b.sort(function(a,b){return a-
b}),b.reverse()):b.sort().reverse();return b},currentAlphaMark:function(){return 0<this._alphaLabels.length?this._alphaLabels[this._alphaLabels.length-1]:null},currentNumericMark:function(){return 0<this._numericLabels.length?this._numericLabels[this._numericLabels.length-1]+"":null},getMark:function(a){return this._ptTolabelMap[a.toString()]||null},_useCurrentAlphaMark:function(){var a=this._alphaLabels.pop();return a?a:null},_useCurrentNumericMark:function(){var a=this._numericLabels.pop()+"";return a?
a:null},isSupportedMark:function(a){return{LABEL_ALPHA:!0,LABEL_NUMERIC:!0,SQUARE:!0,TRIANGLE:!0}[a]||!1},addMark:function(a,b){var c=glift.enums.marks,d=this.movetree.node().properties();if(!this.isSupportedMark(b))return null;if(this.getMark(a))return this.removeMark(a);var e={mark:b},f=null;b===c.LABEL_NUMERIC?(f=this._useCurrentNumericMark(),e.data=f):b===c.LABEL_ALPHA&&(f=this._useCurrentAlphaMark(),e.data=f);c=glift.sgf.markToProperty(b);f&&b?d.add(c,a.toSgfCoord()+":"+f):b&&d.add(c,a.toSgfCoord());
this._ptTolabelMap[a.toString()]=e;return this.getNextBoardState()},removeMark:function(a){var b=glift.enums.marks,c=this.getMark(a);if(!c)return null;delete this._ptTolabelMap[a.toString()];var d=glift.sgf.markToProperty(c.mark);c.mark===b.LABEL_NUMERIC?(this._numericLabels.push(parseInt(c.data)),this._numericLabels.sort(function(a,b){return a-b}).reverse(),this.movetree.properties().removeOneValue(d,a.toSgfCoord()+":"+c.data)):c.mark===b.LABEL_ALPHA?(this._alphaLabels.push(c.data),this.movetree.properties().removeOneValue(d,
a.toSgfCoord()+":"+c.data),this._alphaLabels.sort().reverse()):this.movetree.properties().removeOneValue(d,a.toSgfCoord());return this.getNextBoardState()},addStone:function(a,b){if(!this.canAddStone(a,b))return null;this.goban.addStone(a,b);this.movetree.addNode();this.movetree.properties().add(glift.sgf.colorToToken(b),a.toSgfCoord());return this.getNextBoardState()},addPlacement:function(a,b){var c=glift.sgf.colorToPlacement(b),d=glift.util.colors.oppositeColor(b),e=glift.sgf.colorToPlacement(d),
f=this.goban.addStone(a,b);if(f.successful){this.movetree.properties().add(c,a.toSgfCoord());for(c=0;c<f.captures.length;c++)this.movetree.properties().removeOneValue(e,f.captures[c].toSgfCoord());e={};e[d]=f.captures;return glift.bridge.intersections.nextBoardData(this.movetree,e)}return null},pass:function(){throw Error("Not implemented");},clearStone:function(){throw Error("Not implemented");}};
glift.controllers.gameViewer=function(a){var b=glift.controllers,c=glift.util.beget(b.base()),b=glift.util.setMethods(c,b.GameViewerMethods);b.initOptions(a);return b};
glift.controllers.GameViewerMethods={extraOptions:function(a){},addStone:function(a,b){var c=this._possibleNextMoves(),d=a.toString()+"-"+b;return void 0===c[d]?null:this.nextMove(c[d])},getNextVariationNumber:function(){return this.currentMoveNumber>this.treepath.length||void 0===this.treepath[this.currentMoveNumber]?0:this.treepath[this.currentMoveNumber]},previousCommentOrBranch:function(a){var b=null,c=0;do{var b=this.prevMove(),d=this.movetree.properties().getOneValue("C"),e=this.movetree.node().numChildren();
c++;if(a&&c===a)break}while(b&&!d&&1>=e);this.setNextVariation(0);return this.getEntireBoardState()},nextCommentOrBranch:function(a){var b=null,c=0;do{var b=this.nextMove(),d=this.movetree.properties().getOneValue("C"),e=this.movetree.node().numChildren();c++;if(a&&c===a)break}while(b&&!d&&1>=e);return this.getEntireBoardState()},moveUpVariations:function(){return this.setNextVariation((this.getNextVariationNumber()+1)%this.movetree.node().numChildren())},moveDownVariations:function(){return this.setNextVariation((this.getNextVariationNumber()-
1+ +this.movetree.node().numChildren())%this.movetree.node().numChildren())},_possibleNextMoves:function(){for(var a={},b=this.movetree.nextMoves(),c=0;c<b.length;c++){var d=b[c];a[(void 0!==d.point?d.point.toString():"PASS")+"-"+d.color]=c}return a}};glift.controllers.staticProblem=function(a){var b=glift.util.beget(glift.controllers.base()),b=glift.util.setMethods(b,glift.controllers.StaticProblemMethods);b.initOptions(a);return b};
glift.controllers.StaticProblemMethods={reload:function(){this.initialize()},addStone:function(a,b){var c=glift.enums.problemResults,d=c.CORRECT,e=c.INCORRECT,f=c.INDETERMINATE,c=c.FAILURE;if(!this.goban.placeable(a)||!this.goban.testAddStone(a,b))return{result:c};c=this.movetree.findNextMove(a,b);null===c&&(this.movetree.addNode(),this.movetree.properties().add(glift.sgf.colorToToken(b),a.toSgfCoord()),this.movetree.moveUp(),c=this.movetree.node().numChildren()-1);var c=this.nextMove(c),g=glift.rules.problems.isCorrectPosition(this.movetree,
this.problemConditions);if(g===d||g==e)return c.result=g,c;if(g===f)return this.nextMove(0),c=this.getEntireBoardState(),c.result=f,c;throw"Unexpected result output: "+g;},correctnessStatus:function(){return glift.rules.problems.isCorrectPosition(this.movetree,this.problemConditions)}};
glift.bridge={setDisplayState:function(a,b,c,d){glift.util.majorPerfLog("Set display state");b.intersections().clearMarks();a.displayDataType===glift.enums.displayDataTypes.FULL&&b.intersections().clearAll();for(var e in a.stones)for(var f=0;f<a.stones[e].length;f++){var g=a.stones[e][f];b.intersections().setStoneColor(g,e)}e={};glift.bridge.shouldShowNextMoves(a,c)&&(e=glift.bridge.variationMapping(a.nextMoves));var h={};c=glift.enums.marks;for(var k in a.marks)for(f=0;f<a.marks[k].length;f++)g=
a.marks[k][f],markPtString=(g.point?g.point:g).toString(),h[markPtString]=!0,k===c.LABEL?void 0!==e[markPtString]?(b.intersections().addMarkPt(g.point,c.VARIATION_MARKER,g.value),delete e[markPtString]):b.intersections().addMarkPt(g.point,c.LABEL,g.value):b.intersections().addMarkPt(g,k);f=1;k=glift.bridge.variationMapping(a.correctNextMoves);for(var m in e)g=e[m],g in k?b.intersections().addMarkPt(g,c.CORRECT_VARIATION,f):b.intersections().addMarkPt(g,c.VARIATION_MARKER,f),f+=1;a.lastMove&&a.lastMove.point&&
d&&!h[a.lastMove.point.toString()]&&(a=a.lastMove,b.intersections().addMarkPt(a.point,c.STONE_MARKER));glift.util.majorPerfLog("Finish display state")},shouldShowNextMoves:function(a,b){return a.nextMoves&&(1<a.nextMoves.length&&b===glift.enums.showVariations.MORE_THAN_ONE||1<=a.nextMoves.length&&b===glift.enums.showVariations.ALWAYS)},variationMapping:function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];void 0!==d.point&&(b[d.point.toString()]=d.point)}return b}};
glift.bridge.getCropFromMovetree=function(a){var b=glift.displays.bboxFromPts,c=glift.util.point,d=glift.enums.boardRegions,e=a.getIntersections()-1,f=Math.ceil(e/2),g={},h={},k=0;if(19!==a.getIntersections())return glift.enums.boardRegions.ALL;g[d.TOP_LEFT]=b(c(0,0),c(f,f));g[d.TOP_RIGHT]=b(c(f,0),c(e,f));g[d.BOTTOM_LEFT]=b(c(0,f),c(f,e));g[d.BOTTOM_RIGHT]=b(c(f,f),c(e,e));a.recurseFromRoot(function(a){a=a.properties().getAllStones();for(var b in a)for(var c=a[b],d=0;d<c.length;d++){var e=c[d];k+=
1;for(var r in g){var s=g[r];f!==e.x()&&f!==e.y()&&s.contains(e)&&(void 0===h[r]&&(h[r]=[]),h[r].push(e))}}});return glift.bridge._getRegionFromTracker(h,k)};glift.bridge._getRegionFromTracker=function(a,b){var c=[],d;for(d in a)c.push(d);if(1===c.length)return c[0];if(2!==c.length)return glift.enums.boardRegions.ALL;var c=glift.util.intersection(glift.util.regions.getComponents(c[0]),glift.util.regions.getComponents(c[1])),e;for(e in c)return e;return glift.boardRegions.ALL};
glift.bridge.flattener={symbols:{TL_CORNER:1,TR_CORNER:2,BL_CORNER:3,BR_CORNER:4,TOP_EDGE:5,BOT_EDGE:6,LEFT_EDGE:7,RIGHT_EDGE:8,CENTER:9,CENTER_STARPOINT:10,BSTONE:11,WSTONE:12,EMPTY:13,TRIANGLE:14,SQUARE:15,CIRCLE:16,XMARK:17,TEXTLABEL:18,LASTMOVE:19,NEXTVARIATION:20},symbolFromEnum:function(a){if(void 0!==glift.bridge.flattener._reverseSymbol)return glift.bridge.flattener._reverseSymbol[a];var b={},c=glift.bridge.flattener.symbols,d;for(d in glift.bridge.flattener.symbols)b[c[d]]=d;glift.bridge.flattener._reverseSymbol=
b;return glift.bridge.flattener._reverseSymbol[a]},flatten:function(a,b,c,d,e,f){var g=glift.bridge.flattener.symbols;a=a.newTreeRef();var h=d||glift.enums.showVariations.NEVER,k=e||[];f=f||1;c=c||glift.enums.boardRegions.ALL;c===glift.enums.boardRegions.AUTO&&(c=glift.bridge.getCropFromMovetree(a));e=glift.displays.cropbox.getFromRegion(c,a.getIntersections());d=glift.bridge.flattener._stoneMap(b);var m=glift.rules.treepath.applyNextMoves(a,b,k);a=m.movetree;for(k=0;k<m.stones.length;k++){b=m.stones[k];
b={point:b.point,color:b.color};var l=b.point.toString();d[l]||(d[l]=b)}k=glift.bridge.flattener._markMap(a);b=k.labels;l=k.marks;f=glift.bridge.flattener._labelForCollisions(m.stones,l,b,f);k=glift.enums.showVariations;if(h===k.ALWAYS||h===k.MORE_THAN_ONE&&1<a.node().numChildren())for(k=0;k<a.node().numChildren();k++)(h=a.node().getChild(k).properties().getMove())&&h.point&&(h=h.point.toString(),void 0===b[h]&&(b[h]=""+(k+1)),l[h]=g.NEXTVARIATION);g=glift.bridge.flattener._generateSymbolArr(e,d,
l,a.getIntersections());a=a.properties().getComment()||"";return new glift.bridge._Flattened(g,b,f,a,c,e)},_stoneMap:function(a){var b={};a=a.getAllPlacedStones();for(var c=0;c<a.length;c++){var d=a[c];b[d.point.toString()]=d}return b},_markMap:function(a){var b={marks:{},labels:{}},c=glift.bridge.flattener.symbols,c={CR:c.CIRCLE,LB:c.TEXTLABEL,MA:c.XMARK,SQ:c.SQUARE,TR:c.TRIANGLE},d;for(d in c){var e=c[d];if(a.properties().contains(d))for(var f=a.properties().getAllValues(d),g=0;g<f.length;g++)if(d===
glift.sgf.allProperties.LB){var h=glift.sgf.convertFromLabelData(f[g]),k=h.point.toString();b.marks[k]=e;b.labels[k]=h.value}else h=glift.util.pointFromSgfCoord(f[g]),b.marks[h.toString()]=e}return b},_labelForCollisions:function(a,b,c,d){if(!a||0===a.length)return[];var e=0,f=glift.bridge.flattener.symbols,g=[],h=/[0-9]/,k;for(k in c)h.test(c[k])&&(delete c[k],delete b[k]);for(h=0;h<a.length;h++){var m=a[h];k=m.point.toString();if(m.hasOwnProperty("collision")){var l={color:m.color,mvnum:h+d+""};
c[k]?l.label=c[k]:"number"===glift.util.typeOf(m.collision)?l.label=m.collision+d+"":(m="abcdefghijklmnopqrstuvwxyz".charAt(e),e++,l.label=m,b[k]=f.TEXTLABEL,c[k]=m);g.push(l)}else b[k]=f.TEXTLABEL,c[k]=h+d+""}return g},_generateSymbolArr:function(a,b,c,d){a=a.cbox();for(var e=glift.util.point,f=[],g=a.top();g<=a.bottom();g++){for(var h=[],k=a.left();k<=a.right();k++){var m=e(k,g),l=m.toString();h.push(this._getSymbolPair(m,b[l],c[l],d))}f.push(h)}return f},_getSymbolPair:function(a,b,c,d){var e=
glift.bridge.flattener.symbols,f=glift.enums.states.BLACK,g=glift.enums.states.WHITE,h=glift.enums.states.EMPTY,k=void 0,m=e.EMPTY;if(void 0!==c){var l=h;void 0!==b&&(l=b.color);switch(c){case e.TRIANGLE:m=e.TRIANGLE;break;case e.SQUARE:m=e.SQUARE;break;case e.CIRCLE:m=e.CIRCLE;break;case e.XMARK:m=e.XMARK;break;case e.LASTMOVE:m=e.LASTMOVE;break;case e.TEXTLABEL:m=e.TEXTLABEL;l===h&&(k=e.EMPTY);break;case e.NEXTVARIATION:m=e.NEXTVARIATION,l===h&&(k=e.EMPTY)}}c=d-1;k!==e.EMPTY&&(k=void 0!==b&&b.color===
f?e.BSTONE:void 0!==b&&b.color===g?e.WSTONE:0===a.x()&&0===a.y()?e.TL_CORNER:0===a.x()&&a.y()===c?e.BL_CORNER:a.x()===c&&0===a.y()?e.TR_CORNER:a.x()===c&&a.y()===c?e.BR_CORNER:0===a.y()?e.TOP_EDGE:0===a.x()?e.LEFT_EDGE:a.x()===c?e.RIGHT_EDGE:a.y()===c?e.BOT_EDGE:this._isStarpoint(a,d)?e.CENTER_STARPOINT:e.CENTER);return{base:k,mark:m}},_starPointSets:{9:[{2:!0,6:!0},{4:!0}],13:[{3:!0,9:!0},{6:!0}],19:[{3:!0,9:!0,15:!0}]},_isStarpoint:function(a,b){for(var c=glift.bridge.flattener._starPointSets[b],
d=0;d<c.length;d++){var e=c[d];if(e[a.x()]&&e[a.y()])return!0}return!1}};glift.bridge._Flattened=function(a,b,c,d,e,f){this.symbolPairs=a;this.labelData=b;this.collisions=c;this.comment=d;this.boardRegion=e;this.cropping=f};
glift.bridge._Flattened.prototype={getSymbolPairIntPt:function(a){var b=this.symbolPairs[a.y()-this.cropping.cbox().top()];return void 0===b?b:b[a.x()-this.cropping.cbox().left()]},getSymbolPair:function(a){var b=this.symbolPairs[a.y()];return void 0===b?b:b[a.x()]},getLabelIntPt:function(a){return this.labelData[a.toString()]},getLabel:function(a){return this.getLabelIntPt(this.ptToIntpt(a))},ptToIntpt:function(a){return glift.util.point(a.x()+this.cropping.cbox().left(),a.y()+this.cropping.cbox().top())}};
glift.bridge.intersections={propertiesToMarks:{CR:glift.enums.marks.CIRCLE,LB:glift.enums.marks.LABEL,MA:glift.enums.marks.XMARK,SQ:glift.enums.marks.SQUARE,TR:glift.enums.marks.TRIANGLE},basePropertyData:function(a,b){var c={stones:{WHITE:[],BLACK:[],EMPTY:[]},marks:{},comment:null,lastMove:null,nextMoves:[],correctNextMoves:[],captures:[],displayDataType:glift.enums.displayDataTypes.PARTIAL};c.comment=a.properties().getComment();c.lastMove=a.getLastMove();c.marks=glift.bridge.intersections.getCurrentMarks(a);
c.nextMoves=a.nextMoves();c.correctNextMoves=void 0!==b?glift.rules.problems.correctNextMoves(a,b):[];return c},getFullBoardData:function(a,b,c){a=glift.bridge.intersections.basePropertyData(a,c);a.displayDataType=glift.enums.displayDataTypes.FULL;b=b.getAllPlacedStones();for(c=0;c<b.length;c++){var d=b[c];a.stones[d.color].push(d.point)}return a},nextBoardData:function(a,b,c){c=glift.bridge.intersections.basePropertyData(a,c);c.stones=a.properties().getAllStones();c.stones.EMPTY=[];for(var d in b)for(a=
0;a<b[d].length;a++)c.stones.EMPTY.push(b[d][a]);return c},previousBoardData:function(a,b,c,d){a=glift.bridge.intersections.basePropertyData(a,d);a.stones=c;a.stones.EMPTY=[];for(var e in b)for(c=0;c<b[e].length;c++)a.stones.EMPTY.push(b[e][c]);return a},getCurrentMarks:function(a){var b={},c;for(c in glift.bridge.intersections.propertiesToMarks){var d=glift.bridge.intersections.propertiesToMarks[c];if(a.properties().contains(c)){for(var e=[],f=a.properties().getAllValues(c),g=0;g<f.length;g++)c===
glift.sgf.allProperties.LB?e.push(glift.sgf.convertFromLabelData(f[g])):e.push(glift.util.pointFromSgfCoord(f[g]));b[d]=e}}return b}};
glift.widgets={create:function(a){glift.util.perfInit();a=glift.widgets.createNoDraw(a);glift.util.majorPerfLog("Finish creating manager");a.draw();glift.util.majorPerfLog("Finish drawing manager");glift.util.perfDone();return a},createNoDraw:function(a){a=glift.widgets.options.setOptionDefaults(a);var b={};b.iconActions=a.iconActions;b.stoneActions=a.stoneActions;glift.init(a.display.disableZoomForMobile,a.divId);return new glift.widgets.WidgetManager(a.divId,a.sgfCollection,a.initialListIndex,a.allowWrapAround,
a.sgfDefaults,a.display,a.globalBookData,b)}};glift.create=glift.widgets.create;glift.widgets.BaseWidget=function(a,b,c,d,e){this.wrapperDiv=a;this.type=b.type;this.sgfOptions=glift.util.simpleClone(b);this.displayOptions=glift.util.simpleClone(c);this.actions=d;this.manager=e;this.totalCorrectAnswers=this.numCorrectAnswers=this.correctNextSet=this.correctness=this.initialPlayerColor=this.initialMoveNumber=this.boardRegion=this.iconBar=this.display=this.controller=void 0};
glift.widgets.BaseWidget.prototype={draw:function(){this.controller=this.sgfOptions.controllerFunc(this.sgfOptions);this.initialMoveNumber=this.controller.movetree.node().getNodeNum();this.initialPlayerColor=this.controller.getCurrentPlayer();glift.util.majorPerfLog("Created controller");this.displayOptions.intersections=this.controller.getIntersections();this.displayOptions.boardRegion=this.sgfOptions.boardRegion===glift.enums.boardRegions.AUTO?glift.bridge.getCropFromMovetree(this.controller.movetree):
this.sgfOptions.boardRegion;this.displayOptions.rotation=this.sgfOptions.rotation;glift.util.majorPerfLog("Calculated board regions");var a=glift.displays.bboxFromDiv(this.wrapperDiv);if(0===a.width()||0===a.height())throw Error("Div has has invalid dimensions. Bounding box had width: "+a.width()+", height: "+a.height());var b=glift.displays.positionWidget(a,this.displayOptions.boardRegion,this.displayOptions.intersections,this.sgfOptions.componentsToUse,this.displayOptions.oneColumnSplits,this.displayOptions.twoColumnSplits),
c=this._createDivsForPositioning(b,this.wrapperDiv);glift.util.majorPerfLog("Created divs");this.displayOptions.divId=c.boardBoxId;var d=glift.themes.get(this.displayOptions.theme);this.display=glift.displays.create(this.displayOptions,b.boardBox);glift.util.majorPerfLog("Finish creating display");c.commentBoxId&&this._createCommentBox(c.commentBoxId,b.commentBox,d);glift.util.majorPerfLog("CommentBox");c.iconBarBoxId&&this._createIconBar(c.iconBarBoxId,b.iconBarBox,this.sgfOptions.icons,a,d);glift.util.majorPerfLog("IconBar");
c.iconBarBoxId&&this.iconBar.initIconActions(this,this.actions.iconActions);glift.util.majorPerfLog("Before stone event creation");this._initStoneActions(this.actions.stoneActions);this._initKeyHandlers();glift.util.majorPerfLog("After stone event creation");this._initProblemData();this.applyBoardData(this.controller.getEntireBoardState());return this},_createDivsForPositioning:function(a,b){for(var c=["boardBox","iconBarBox","commentBox","extraIconBarBox"],d={},e=0;e<c.length;e++)if(a[c[e]]){var f=
d,g=c[e]+"Id",h=a[c[e]],k=b+"_internal_div_"+glift.util.idGenerator.next(),m=glift.dom.newDiv(k),h={top:h.top()+"px",left:h.left()+"px",width:h.width()+"px",height:h.height()+"px",position:"absolute",cursor:"default"};m.css(h);glift.dom.elem(b).append(m);glift.displays.setNotSelectable(k);f[g]=k}return d},_getProblemType:function(){var a=this.controller.movetree.properties(),b=glift.enums.problemTypes;return a.contains("EV")&&(a=a.getOneValue("EV").toUpperCase(),void 0!==b[a]&&a!==b.AUTO)?a:0===this.controller.movetree.nextMoves().length?
b.EXAMPLE:b.STANDARD},_createCommentBox:function(a,b,c){this.commentBox=glift.displays.commentbox.create(a,b,c)},_createIconBar:function(a,b,c,d,e){this.iconBar=glift.displays.icons.bar({theme:e,divId:a,icons:c,positioning:b,parentBbox:d})},_initStoneActions:function(a){var b,c;b=a.mouseover;c=a.mouseout;a=this.sgfOptions.stoneClick;this.sgfOptions.stoneMouseover&&(b=this.sgfOptions.stoneMouseover);this.sgfOptions.stoneMouseout&&(c=this.sgfOptions.stoneMouseout);var d=this,e=function(a){return function(b,
c){d.manager.setActive();a(b,d,c)}},d=this;b&&c&&!glift.platform.isMobile()&&this.display.intersections().setHover(e(b),e(c));a&&(b="click",glift.platform.isMobile()&&(b="touchstart"),this.display.intersections().setEvent(b,e(a)))},_initKeyHandlers:function(){if(this.displayOptions.enableKeyboardShortcuts){for(var a in this.sgfOptions.keyMappings)glift.keyMappings.registerKeyAction(this.manager.id,a,this.sgfOptions.keyMappings[a]);glift.keyMappings.initKeybindingListener()}},_initProblemData:function(){if(this.sgfOptions.widgetType===
glift.enums.widgetTypes.CORRECT_VARIATIONS_PROBLEM){var a=glift.rules.problems.correctNextMoves(this.controller.movetree,this.sgfOptions.problemConditions);this.correctNextSet=this.correctNextSet||{};this.numCorrectAnswers=this.numCorrectAnswers||0;this.totalCorrectAnswers=this.totalCorrectAnswers||this.sgfOptions.totalCorrectVariationsOverride||a.length;this.iconBar.addTempText("multiopen-boxonly",this.numCorrectAnswers+"/"+this.totalCorrectAnswers,"black")}},applyBoardData:function(a){a&&(this.setCommentBox(a.comment),
glift.bridge.setDisplayState(a,this.display,this.sgfOptions.showVariations,this.sgfOptions.markLastMove))},setCommentBox:function(a){void 0!==this.commentBox&&(a?this.commentBox.setText(a):this.commentBox.clearText());return this},reload:function(){void 0!==this.correctness&&(this.totalCorrectAnswers=this.numCorrectAnswers=this.correctNextSet=void 0);this.redraw()},redraw:function(){this.destroy();this.draw()},destroy:function(){glift.keyMappings.unregisterInstance(this.manager.id);glift.dom.elem(this.wrapperDiv)&&
glift.dom.elem(this.wrapperDiv).empty();this.correctness=void 0;void 0!==this.keyHandlerFunc&&(document.body.keydown=null);this.display=this.keyHandlerFunc=void 0}};
glift.widgets.WidgetManager=function(a,b,c,d,e,f,g,h){this.id=a+"-glift-"+glift.util.idGenerator.next();glift.global.instanceRegistry[this.id]=this;!glift.global.activeInstanceId&&this.setActive();this.divId=a;this.sgfCollection=[];this.sgfCollectionUrl=null;"string"===glift.util.typeOf(b)?this.sgfCollectionUrl=b:this.sgfCollection=b;this.sgfColIndex=c;this.allowWrapAround=d;this.sgfDefaults=e;this.displayOptions=f;this.bookData=g;this.actions=h;this.currentWidget=void 0;this.sgfCache={}};
glift.widgets.WidgetManager.prototype={draw:function(){var a=function(){var a=this.getCurrentSgfObj();this.getSgfString(a,function(a){this.destroy();this.currentWidget=this.createWidget(a).draw()}.bind(this))}.bind(this);0===this.sgfCollection.length&&this.sgfCollectionUrl?glift.ajax.get(this.sgfCollectionUrl,function(b){this.sgfCollection=JSON.parse(b);a()}.bind(this)):a();return this},redraw:function(){this.currentWidget&&this.currentWidget.redraw()},setActive:function(){glift.global.activeInstanceId=
this.id},getCurrentWidget:function(){return this.temporaryWidget?this.temporaryWidget:this.currentWidget},getCurrentSgfObj:function(){return this.getSgfObj(this.sgfColIndex)},_resetIcons:function(a){1<this.sgfCollection.length&&(this.allowWrapAround?(a.icons.push(this.displayOptions.nextSgfIcon),a.icons.splice(0,0,this.displayOptions.previousSgfIcon)):0===this.sgfColIndex?a.icons.push(this.displayOptions.nextSgfIcon):(this.sgfColIndex!==this.sgfCollection.length-1&&a.icons.push(this.displayOptions.nextSgfIcon),
a.icons.splice(0,0,this.displayOptions.previousSgfIcon)));return a},getSgfObj:function(a){if(0>a||a>this.sgfCollection.length)throw Error("Index ["+a+" ] out of bounds. List size was "+this.sgfCollection.length);a=this.sgfCollection[a];if("string"===glift.util.typeOf(a)){var b={};/^\s*\(;/.test(a)?b.sgfString=a:b.url=a;a=b}a=glift.widgets.options.setSgfOptions(a,this.sgfDefaults);return this._resetIcons(a)},getSgfString:function(a,b){a.url?this.loadSgfWithAjax(a.url,a,b):b(a)},createWidget:function(a){return new glift.widgets.BaseWidget(this.divId,
a,this.displayOptions,this.actions,this)},createTemporaryWidget:function(a){this.currentWidget&&this.currentWidget.destroy();a=glift.widgets.options.setSgfOptions(a,this.sgfDefaults);this.temporaryWidget=this.createWidget(a).draw()},returnToOriginalWidget:function(){this.temporaryWidget&&this.temporaryWidget.destroy();this.temporaryWidget=void 0;this.currentWidget.draw()},_nextSgfInternal:function(a){1<!this.sgfCollection.length||(this.allowWrapAround?this.sgfColIndex=(this.sgfColIndex+a+this.sgfCollection.length)%
this.sgfCollection.length:(this.sgfColIndex+=a,0>this.sgfColIndex?this.sgfColIndex=0:this.sgfColIndex>=this.sgfCollection.length&&(this.sgfColIndex=this.sgfCollection.length-1)),this.draw())},nextSgf:function(){this._nextSgfInternal(1)},prevSgf:function(){this._nextSgfInternal(-1)},clearSgfCache:function(){this.sgfCache={}},loadSgfWithAjax:function(a,b,c){a&&this.sgfCache[a]?(b.sgfString=this.sgfCache[a],c(b)):glift.ajax.get(a,function(d){this.sgfCache[a]=d;b.sgfString=d;c(b)}.bind(this))},prepopulateCache:function(a){for(var b=
0,c=0;c<this.sgfCollection.length;c++){var d=this.getSgfObj(c);this.getSgfString(d,function(){b+=1})}var e=function(c){0<c&&b<this.sgfCollection.length?window.setTimeout(function(){e(c-1)},500):a()}.bind(this);e(3)},destroy:function(){this.currentWidget&&this.currentWidget.destroy();this.currentWidget=void 0;this.temporaryWidget&&this.temporaryWidget.destroy();this.temporaryWidget=void 0;return this}};
glift.widgets.options={setOptionDefaults:function(a){var b=glift.widgets.options;b._validateOptions(a);a=glift.util.simpleClone(a);for(var c=glift.util.simpleClone(b.baseOptions),d=["divId","sgfCollection","initialListIndex","allowWrapAround"],e=0;e<d.length;e++)a.hasOwnProperty(d[e])||(a[d[e]]=c[d[e]]);d=["sgfDefaults","globalBookData","display","iconActions","stoneActions"];for(e=0;e<d.length;e++)b._setDefaults(a,c,d[e]);a.sgf&&(a.sgfCollection=[],a.sgfCollection.push(a.sgf),a.sgf=void 0);a.sgf||
a.sgfCollection||(a.sgfCollection=[{}]);return a},_validateOptions:function(a){if(a.sgf&&a.sgfCollection)throw Error("Illegal options configuration: you cannot define both sgf and sgfCollection");},_setDefaults:function(a,b,c){var d=a[c]||{};b=b[c];for(var e in b)d.hasOwnProperty(e)||(d[e]=b[e]);a[c]=d;return a},setSgfOptions:function(a,b){if("object"!==glift.util.typeOf(a))throw Error("SGF must be of type object, was: "+glift.util.typeOf(a)+", for "+a);a=glift.util.simpleClone(a);var c=glift.widgets.options[a.widgetType||
b.widgetType],d;for(d in c)a[d]||(a[d]=glift.util.simpleClone(c[d]));c={bookData:!0};for(d in b)if(!a[d]&&void 0!==b[d])a[d]=b[d];else if(c[d])for(var e in b[d])a[d].hasOwnProperty(e)||(a[d][e]=b[d][e]);return a}};
glift.widgets.options.baseOptions={sgf:void 0,sgfDefaults:{widgetType:glift.enums.widgetTypes.GAME_VIEWER,initialPosition:"",boardRegion:glift.enums.boardRegions.AUTO,rotation:glift.enums.rotations.NO_ROTATION,problemCallback:function(){},problemConditions:{GB:[],C:["Correct","is correct","is the correct"]},keyMappings:{ARROW_LEFT:"iconActions.chevron-left.click",ARROW_RIGHT:"iconActions.chevron-right.click"},componentsToUse:["BOARD","COMMENT_BOX","ICONBAR"],correctVariationsResetTime:void 0,totalCorrectVariationsOverride:void 0,
bookData:{diagramType:"GAME_REVIEW",showDiagram:!0},showVariations:"MORE_THAN_ONE",markLastMove:!0,controllerFunc:void 0,icons:void 0,stoneClick:void 0,stoneMouseover:void 0,stoneMouseout:void 0},divId:"glift_display",sgfCollection:void 0,initialListIndex:0,allowWrapAround:!1,globalBookData:{title:"My Go Book",subtitle:"Going the distance!",authors:[],publisher:"Created with Glift",diagramsPerPage:2,templateUrl:"",autoNumber:!0},display:{goBoardBackground:"",oneColumnSplits:{first:[{component:"BOARD",
ratio:0.7},{component:"COMMENT_BOX",ratio:0.2},{component:"ICONBAR",ratio:0.1}]},twoColumnSplits:{first:[{component:"BOARD",ratio:1}],second:[{component:"COMMENT_BOX",ratio:0.85},{component:"ICONBAR",ratio:0.15}]},theme:"DEFAULT",previousSgfIcon:"chevron-left",nextSgfIcon:"chevron-right",drawBoardCoords:!1,disableZoomForMobile:!1,enableKeyboardShortcuts:!0},stoneActions:{click:void 0,mouseover:function(a,b,c){a={BLACK:"BLACK_HOVER",WHITE:"WHITE_HOVER"};var d=b.controller.getCurrentPlayer();b.controller.canAddStone(c,
d)&&b.display.intersections().setStoneColor(c,a[d])},mouseout:function(a,b,c){a=b.controller.getCurrentPlayer();b.controller.canAddStone(c,a)&&b.display&&b.display.intersections().setStoneColor(c,"EMPTY")},touchend:function(a,b,c){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();b.sgfOptions.stoneClick(a,b,c)}},iconActions:{start:{click:function(a,b,c,d){b.applyBoardData(b.controller.toBeginning())},tooltip:"Go to the beginning"},end:{click:function(a,b,c,d){b.applyBoardData(b.controller.toEnd())},
tooltip:"Go to the end"},arrowright:{click:function(a,b,c,d){b.applyBoardData(b.controller.nextMove())},tooltip:"Next move"},arrowleft:{click:function(a,b,c,d){b.applyBoardData(b.controller.prevMove())},tooltip:"Previous move"},"chevron-right":{click:function(a,b,c,d){b.manager.nextSgf()},tooltip:"Next panel"},"chevron-left":{click:function(a,b,c,d){b.manager.prevSgf()},tooltip:"Previous panel"},refresh:{click:function(a,b,c,d){b.reload()},tooltip:"Try the problem again"},"undo-problem-move":{click:function(a,
b,c,d){b.controller.movetree.node().getNodeNum()<=b.initialMoveNumber||(b.initialPlayerColor===b.controller.getCurrentPlayer()&&b.applyBoardData(b.controller.prevMove()),b.applyBoardData(b.controller.prevMove()),b.initialMoveNumber===b.controller.movetree.node().getNodeNum()?b.reload():(a=glift.enums.problemResults,c=b.controller.correctnessStatus(),b.iconBar.destroyTempIcons(),c===a.CORRECT?(b.iconBar.setCenteredTempIcon("multiopen-boxonly","check","#0CC"),b.correctness=a.CORRECT):c===a.INCORRECT&&
(b.iconBar.destroyTempIcons(),b.iconBar.setCenteredTempIcon("multiopen-boxonly","cross","red"),b.correctness=a.INCORRECT)))},tooltip:"Undo last move attempt"},undo:{click:function(a,b,c,d){b.manager.returnToOriginalWidget()},tooltip:"Return to the parent widget"},"jump-left-arrow":{click:function(a,b,c,d){b.applyBoardData(b.controller.previousCommentOrBranch(20))},tooltip:"Previous branch or comment"},"jump-right-arrow":{click:function(a,b,c,d){b.applyBoardData(b.controller.nextCommentOrBranch(20))},
tooltip:"Previous branch or comment"},roadmap:{click:function(a,b,c,d){a=b.manager;b={widgetType:glift.enums.widgetTypes.GAME_VIEWER,initialPosition:b.sgfOptions.initialPosition,sgfString:b.sgfOptions.sgfString,showVariations:glift.enums.showVariations.ALWAYS,problemConditions:glift.util.simpleClone(b.sgfOptions.problemConditions),icons:["jump-left-arrow","jump-right-arrow","arrowleft","arrowright","undo"],rotation:b.sgfOptions.rotation,boardRegion:b.sgfOptions.boardRegion};a.createTemporaryWidget(b)},
tooltip:"Explore the solution"},multiopen:{click:function(a,b,c,d){glift.displays.icons.iconSelector(b.wrapperDiv,d.divId,c).setIconEvents("click",function(a,b){var c=d.getIcon("multiopen");c.setActive(b.iconName);d.setCenteredTempIcon("multiopen",c.getActive(),"black")})}},"multiopen-boxonly":{mouseover:function(){},mouseout:function(){},tooltip:"Shows if the problem is solved"}}};
glift.widgets.options.BOARD_EDITOR={_markMap:{bstone_a:glift.enums.marks.LABEL_ALPHA,bstone_1:glift.enums.marks.LABEL_NUMERIC,bstone_square:glift.enums.marks.SQUARE,bstone_triangle:glift.enums.marks.TRIANGLE},_placementMap:{bstone:glift.enums.states.BLACK,wstone:glift.enums.states.WHITE},stoneClick:function(a,b,c){b.display.intersections().clearTempMarks();a=glift.widgets.options.BOARD_EDITOR._placementMap;var d=glift.widgets.options.BOARD_EDITOR._markMap,e=b.iconBar.getIcon("multiopen").getActive().iconName,
f=b.controller.getCurrentPlayer();a[e]?(c=b.controller.addPlacement(c,a[e]),b.applyBoardData(c)):d[e]?(c=b.controller.addMark(c,d[e]))&&b.applyBoardData(c):"twostones"===e&&(c=b.controller.addStone(c,f))&&b.applyBoardData(c)},stoneMouseover:function(a,b,c){var d=glift.enums.marks,e=glift.widgets.options.BOARD_EDITOR._markMap,f=glift.widgets.options.BOARD_EDITOR._placementMap,g={BLACK:"BLACK_HOVER",WHITE:"WHITE_HOVER"},h=b.controller.getCurrentPlayer();a=b.display.intersections();var k=b.iconBar.getIcon("multiopen").getActive().iconName;
void 0!==f[k]?(d=f[k],b.controller.canAddStone(c,h)&&a.setStoneColor(c,g[d])):"twostones"===k?(d=b.controller.getCurrentPlayer(),b.controller.canAddStone(c,h)&&a.setStoneColor(c,g[d])):e[k]&&!a.hasMark(c)&&(g=e[k],g===d.LABEL_NUMERIC?a.addTempMark(c,g,b.controller.currentNumericMark()):g===d.LABEL_ALPHA?a.addTempMark(c,g,b.controller.currentAlphaMark()):a.addTempMark(c,g))},stoneMouseout:function(a,b,c){var d=b.controller.getCurrentPlayer(),d=b.iconBar.getIcon("multiopen").getActive().iconName;a=
b.display.intersections();if("twostones"===d||"bstone"===d||"wstone"===d)d=b.controller.getCurrentPlayer(),b.controller.canAddStone(c,d)&&a.setStoneColor(c,"EMPTY");a.clearTempMarks()},icons:["start","end","arrowleft","arrowright","twostones bstone wstone bstone_a bstone_1 bstone_triangle bstone_square nostone-xmark".split(" ")],problemConditions:{},showVariations:glift.enums.showVariations.ALWAYS,controllerFunc:glift.controllers.boardEditor};
glift.widgets.options.CORRECT_VARIATIONS_PROBLEM={stoneClick:function(a,b,c){a=b.controller.getCurrentPlayer();a=b.controller.addStone(c,a);var d=glift.enums.problemResults;if(a.result!==d.FAILURE){b.applyBoardData(a);var e=b.sgfOptions.problemCallback;void 0===b.correctness&&(a.result===d.CORRECT?(b.iconBar.destroyTempIcons(),void 0===b.correctNextSet[c.toString()]&&(b.correctNextSet[c.toString()]=!0,b.numCorrectAnswers++,b.numCorrectAnswers===b.totalCorrectAnswers?(b.correctness=d.CORRECT,b.iconBar.addTempText("multiopen-boxonly",
b.numCorrectAnswers+"/"+b.totalCorrectAnswers,"#0CC"),e(d.CORRECT)):(b.iconBar.addTempText("multiopen-boxonly",b.numCorrectAnswers+"/"+b.totalCorrectAnswers,"#000"),setTimeout(function(){b.controller.initialize();b.applyBoardData(b.controller.getEntireBoardState())},b.sgfOptions.correctVariationsResetTime)))):a.result==d.INCORRECT&&(b.iconBar.destroyTempIcons(),b.iconBar.setCenteredTempIcon("multiopen-boxonly","cross","red"),b.iconBar.clearTempText("multiopen-boxonly"),b.correctness=d.INCORRECT,e(d.INCORRECT)))}},
showVariations:glift.enums.showVariations.NEVER,icons:["refresh","roadmap","multiopen-boxonly"],controllerFunc:glift.controllers.staticProblem,correctVariationsResetTime:750};glift.widgets.options.EXAMPLE={stoneClick:function(a,b,c){},icons:[],problemConditions:{},showVariations:glift.enums.showVariations.NEVER,controllerFunc:glift.controllers.gameViewer,stoneMouseover:function(){},stoneMouseout:function(){}};
glift.widgets.options.GAME_VIEWER={stoneClick:function(a,b,c){a=b.controller.getCurrentPlayer();c=b.controller.addStone(c,a);b.applyBoardData(c)},keyMappings:{ARROW_LEFT:"iconActions.arrowleft.click",ARROW_RIGHT:"iconActions.arrowright.click"},icons:["jump-left-arrow","jump-right-arrow","arrowleft","arrowright"],showVariations:glift.enums.showVariations.MORE_THAN_ONE,problemConditions:{},controllerFunc:glift.controllers.gameViewer};
glift.widgets.options.REDUCED_GAME_VIEWER={stoneClick:function(a,b,c){a=b.controller.getCurrentPlayer();c=b.controller.addStone(c,a);b.applyBoardData(c)},icons:["arrowleft","arrowright"],problemConditions:{},showVariations:glift.enums.showVariations.MORE_THAN_ONE,controllerFunc:glift.controllers.gameViewer};
glift.widgets.options.STANDARD_PROBLEM={stoneClick:function(a,b,c){a=b.controller.getCurrentPlayer();c=b.controller.addStone(c,a);a=glift.enums.problemResults;if(c.result!==a.FAILURE){b.applyBoardData(c);var d=b.sgfOptions.problemCallback;c.result===a.CORRECT?(b.iconBar.setCenteredTempIcon("multiopen-boxonly","check","#0CC"),b.correctness=a.CORRECT,d(a.CORRECT)):c.result===a.INCORRECT&&(b.iconBar.destroyTempIcons(),b.iconBar.setCenteredTempIcon("multiopen-boxonly","cross","red"),b.correctness=a.INCORRECT,
d(a.INCORRECT))}},showVariations:glift.enums.showVariations.NEVER,icons:["undo-problem-move","roadmap","multiopen-boxonly"],controllerFunc:glift.controllers.staticProblem};
